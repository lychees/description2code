#include <iostream>
#include <map>
using namespace std;

int main()
{
	//ios_base::sync_with_stdio(false);
    int t;
    cin>>t;
    long long int nos[1000001];
    while (t--) {
    	long long int n;
    	long long int ao,a1;
    	long long int mod;
    	cin>>ao>>a1>>n>>mod;
    	//map<int,int> mymap;
    	//map<int,int>::iterator it;
    	//if (ao == a1) {
    	//	mymap.insert(pair<int,int>(ao,2));
    	//} else {
    	//	mymap.insert(pair<int,int>(ao, 1));
    	//	mymap.insert(pair<int,int>(a1, 1));
    	//}
    	for (int i=0; i<=1000000; i++)
    		nos[i] = 0;
    	nos[ao]++;
    	nos[a1]++;
    	for (int i=2; i<n; i++) {
    		int val = (ao+a1)%mod;
    		nos[val]++;
    		//it = mymap.find(val);
    		//if (it != mymap.end()) {
    		//	it->second++;
    			//mymap.erase(it);
    			//mymap.insert(pair<int,int>(val, val2+1));
    		//} else {
    		//	mymap.insert(pair<int,int>(val,1));
    		//}
    		ao = a1;
    		a1 = val;
    	}
    	long long int cnt = 0;
    	//for (it = mymap.begin(); it != mymap.end(); it++) {
    	//	cnt += ((it->second)*(it->second));
    	//}
    	for (int i=0; i<=1000000; i++) {
    		if (nos[i] > 0) {
    			//cout<<nos[i]<<" "<<i<<"aa ";
    			cnt += nos[i]*nos[i];
    		}
    	}
    	cout<<cnt<<"\n";
    }
    return 0;
}
