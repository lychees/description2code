#include <iostream>
#include<bits/stdc++.h>
using namespace std;

long long int a[100001];

int main()
{
	int t;
	cin>>t;
	while(t--){
	long long int i,j,n,l,r,ans=0,d;
	cin>>n>>d;
	for(i=1;i<=n;i++)
	cin>>a[i];
	l=1;r=1;
	while(1)
	{
		if(l>n || r>n)
		break;
		if(a[r]-a[l]<=d)
		r++;
		else
		{
			ans+=max(0LL,((r-l-1)*(r-l-2))/2);
			l++;
		}
	}
	if(r==n+1 && l<=n)
	{
		for(i=l;i<=n;i++)
		ans+=max(0LL,((r-i-1)*(r-i-2))/2);
	}
//	ans+=max(0,((r-l-1)*(r-l-2))/2);
	cout<<ans<<endl;
	}
	return 0;
}