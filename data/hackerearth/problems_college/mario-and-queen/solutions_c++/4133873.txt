#include<iostream>
#include<cstdio>

using namespace std;

char arr[15][15];
int visited[15][15];

int Answer;
bool flag;
int N;

int starting_pointX;
int starting_pointY;

int index;
int ans_array[100];
int temp;
int GlobalMin;

int calculate(int X, int Y, int l)
{
    if(arr[X][Y] == 'Q')
    {
        flag = true;
        if(ans_array[l] == 0)
         {
            ans_array[l] = 1;
            if(l < GlobalMin)
            {
                GlobalMin =  l;
            }
         }
        //cout<<l<<endl;
    }

    else
        {

    if( (arr[X][Y-1] == '.' || arr[X][Y-1] == 'Q' ) && visited[X][Y-1] == 0)
    {
        visited[X][Y-1] = 1;
        calculate(X,Y-1,l+1);
        visited[X][Y-1] = 0;
    }

    if( (arr[X][Y+1] == '.' || arr[X][Y+1] == 'Q' ) && visited[X][Y+1] == 0)
    {
        visited[X][Y+1] = 1;
        calculate(X,Y+1,l+1);
        visited[X][Y+1] = 0;
    }

    if( (arr[X-1][Y-1] == '.' || arr[X-1][Y-1] == 'Q' ) && visited[X-1][Y-1] == 0)
    {
        visited[X-1][Y-1] = 1;
        calculate(X-1,Y-1,l+1);
        visited[X-1][Y-1] = 0;
    }

    if( (arr[X-1][Y] == '.' || arr[X-1][Y] == 'Q' ) && visited[X-1][Y] == 0)
    {
        visited[X-1][Y] = 1;
        calculate(X-1,Y,l+1);
        visited[X-1][Y] = 0;
    }

    if( (arr[X-1][Y+1] == '.' || arr[X-1][Y+1] == 'Q' ) && visited[X-1][Y+1] == 0)
    {
        visited[X-1][Y+1] = 1;
        calculate(X-1,Y+1,l+1);
        visited[X-1][Y+1] = 0;
    }

    if( (arr[X+1][Y-1] == '.'  || arr[X+1][Y-1] == 'Q' ) && visited[X+1][Y-1] == 0)
    {
        visited[X+1][Y-1] = 1;
        calculate(X+1,Y-1,l+1);
        visited[X+1][Y-1] = 0;
    }

    if( (arr[X+1][Y] == '.' || arr[X+1][Y] == 'Q' ) && visited[X+1][Y] == 0)
    {
        visited[X+1][Y] = 1;
        calculate(X+1,Y,l+1);
        visited[X+1][Y] = 0;
    }

    if( (arr[X+1][Y+1] == '.' || arr[X+1][Y+1] == 'Q' ) && visited[X+1][Y+1] == 0)
    {
        visited[X+1][Y+1] = 1;
        calculate(X+1,Y+1,l+1);
        visited[X+1][Y+1] = 0;
    }

        }

    return 0;
}

int main()
{
    int T;

    cin>>T;

    for(int test_case = 1; test_case <=T; test_case++)
    {

    cin>>N;

    flag = false;
    Answer = -1;
    index = 1;
    GlobalMin = 1000;

    for(int i=0; i<100; i++)
    {
        //ans_array[i] = 10000;
        ans_array[i] = 0;
    }

    for(int i=0; i<15; i++)
    {
        for(int j=0; j<15;j++)
        {
            arr[i][j] = '@';
            visited[i][j] = 0;
        }
    }


    for(int i=1; i<=N; i++)
    {
        for(int j=1; j<=N; j++)
        {
            cin>>arr[i][j];
        }
    }


    for(int i=1; i<=N; i++)
    {
        for(int j=1; j<=N; j++)
        {
            if(arr[i][j] == 'M')
            {
                starting_pointX = i;
                starting_pointY = j;
            }
        }
    }

    visited[starting_pointX][starting_pointY] = 1;

    calculate(starting_pointX, starting_pointY, 0);

    //cout<<"index = "<<index<<endl;

    /*for(int i=1; i<index-1; i++)
    {
        for(int j=1; j<index-1; j++)
        {
            if(ans_array[j+1] < ans_array[j])
            {
              temp = ans_array[j];
              ans_array[j] = ans_array[j+1];
              ans_array[j+1] = temp;
            }
        }
    }*/

    /*for(int i=1; i<index; i++)
    {
        if(ans_array[i] < GlobalMin)
        {
            GlobalMin = ans_array[i];
        }
    }*/

    cout<<"Case "<<test_case<<": ";
    if(flag == false)
    {
        cout<<Answer<<endl;
    }
    else
    {
        cout<<GlobalMin<<" < ";
        for(int i=1; i<100; i++)
        {
            if(ans_array[i] == 1)
            {
                cout<<i<<" ";
            }

        }
        cout<<"> "<<endl;
    }

    }
    return 0;
}
