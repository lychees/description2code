#include <bits/stdc++.h>
using namespace std;
int a[100005][3];
void fun(int cur,int n)
{
	if(cur>n/2)
	{
		a[cur][1]=0;
		a[cur][2]=0;
		return;
	}
	fun(cur*2,n);
	fun(cur*2+1,n);
	a[cur][1]=max(a[cur*2][1],a[cur*2][2])+a[cur*2][0];
	a[cur][2]=max(a[cur*2+1][1],a[cur*2+1][2])+a[cur*2+1][0];
}
int main()
{
	int t,n;
	scanf("%d",&t);
	int ans;
	while(t--)
	{
	ans=INT_MIN;
		scanf("%d",&n);
		for(int i=1;i<=n;i++)
	     cin>>a[i][0];
	     fun(1,n);
	     for(int i=1;i<=n;i++)
	     {
	     ans=max(ans,a[i][0]+a[i][1]+a[i][2]);
	}
	cout<<ans<<"\n";
	}
	return 0;
	
	
}