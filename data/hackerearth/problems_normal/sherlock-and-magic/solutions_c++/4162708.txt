#include <bits/stdc++.h>
#define b first
#define v second
using namespace std;

int main()
{
    float t,n,i,j,k,c,y,x,f,g,q;
    float w;
    char d;
    cin>>t;
    while(t--)
    {
    	vector<pair<pair<float,float>,char> > a;
    	cin>>n;
    	q=4009;
    	a.clear();
    	c=n;
    	g=0;
    	for(i=0;i<n;i++)
    	{
    		cin>>x>>y>>d;
    		a.push_back(make_pair(make_pair(x,y),d));
    	}
    	for(w=0;w<2002;w=w+0.5)
    	{
    		for(j=0;j<n;j++)
    		{
    		    f=0;
    			for(k=j+1;k<n;k++)
    				if(a[j].b==a[k].b)
    				{
    					c--; f=1;
    					a[k].b.b=q++;
    					a[k].v='p';
    				}
    			if(f==1)
                {
                    g++;
    				a[j].b.b=q++;
            		a[j].v='p';
                }
    		}
    		for(j=0;j<n;j++)
    		{
    			if(a[j].v=='N')
    			a[j].b.v=a[j].b.v+0.5;
    			else if(a[j].v=='S')
    			a[j].b.v=a[j].b.v-0.5;
    			else if(a[j].v=='E')
    			a[j].b.b=a[j].b.b+0.5;
    			else if(a[j].v=='W')
    			a[j].b.b=a[j].b.b-0.5;
    		}
    	}
    	cout<<c-g<<endl;
    }
}
