#include <bits/stdc++.h>
#define PB push_back
#define MP make_pair
#define LL long long
#define N 112345
#define M 1000000007
#define F first
#define S second
#define sc(x) scanf("%d",&x)
#define scl(x) scanf("%lld",&x)
using namespace std;

int a[N], b[N], Left[N], Right[N];
LL val[N];
pair<int, int > p[N];

int main(){
    int n, t, i, j, tmp, cnt;
    LL ans;
    sc(t);
    while(t--){
        sc(n);
        a[0] = -1;
        a[n + 1] = -1;
        for(i=1;i<=n;i++){
            sc(a[i]);
            p[i] = MP(a[i], i);
        }
        sort(p + 1, p + n + 1);
        for(i=1;i<=n;i++){
            b[p[i].S] = i;
            val[i] = p[i].F;
        }

        b[0] = n + 1;
        b[n + 1] = n + 1;
        for(i=1;i<=n;i++){
            Left[b[i]] = b[i - 1];
            Right[b[i]] = b[i + 1];
        }

        cnt = 0;
        ans = 0;
        for(i=2;i<=n;i++){
            tmp = b[p[i].S];
            while(Left[tmp] < tmp || Right[tmp] < tmp){
                if(Left[tmp] < tmp){
                    ans += val[tmp];
                    j = Left[Left[tmp]];
                    Right[j] = tmp;
                    Left[tmp] = j;
                }
                else{
                    ans += val[tmp];
                    j = Right[Right[tmp]];
                    Left[j] = tmp;
                    Right[tmp] = j;
                }
                cnt++;
                if(cnt == n - 1)
                    break;
            }
            if(cnt ==  n - 1)
                break;
        }
        printf("%lld\n",ans);
    }
}
