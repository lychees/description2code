//---chinmay2------

#include<bits/stdc++.h>
using namespace std;

typedef long long int lli;

#define MOD 1000000007

#define		scan(x)				scanf("%d", &x)
#define		scan2(x,y)			scanf("%d %d", &x, &y)
#define		print(x)			printf("%d", x)
#define		prints(x)			printf("%d ", x)
#define		printn(x)			printf("%d\n", x)

#define		scan_lli(x)			scanf("%lld", &x)
#define		scan2_lli(x,y)		scanf("%lld %lld", &x, &y)
#define		print_lli(x)		printf("%lld", x)
#define		prints_lli(x)		printf("%lld ", x)
#define		printn_lli(x)		printf("%lld\n", x)

#define		for_up(v, s, e)		for (int v=s; v<e; v++)
#define		for_down(v, s, e)	for (int v=s; v>=e; v--)

typedef vector<int> vi;
typedef pair<int, int> pii;
typedef vector< pair<int, int> > vpii;

#define pb push_back
#define mp make_pair

#define fs first
#define sc second

int main()
{
	int L, C;
    scan2(L, C);
    
    int con[L+1];
    char cr[L+1];
    for_up (i, 1, L+1) {
    	con[i] = 62;
    	cr[i] = '-';
    }
    
    vector<lli> s;
    s.pb(0);
    
    vector<vector<lli> > A;
    A.pb(s);
    for_up (x, 1, L+1) {
    	A.pb(s);
    	A[x].pb(1);
    }
    
    int x = L+1;
    while (true) {
    	if (A[x-L].back() >= 1e15) break;
    	A.pb(s);
    	for_up (i, x-L, x) {
    		int n = A[i].size();
    		A[x].pb(A[x][i-x+L]+A[i][n-1]);
    		if (A[x][i-x+L+1] >= 1e15) break;
    	}
    	x++;
    }
    x--;
    
    while (C--) {
    	lli N, X;
    	char c;
    	scan2_lli(N, X);
    	getchar();
    	c = getchar();
    	
    	X -= max(0LL, (lli) ceil(1.0*(X-x)/L)) * L;
    	
    	while (X > L) {
    		int p = (int) (lower_bound(A[X].begin(), A[X].end(), N) - A[X].begin());
    		N -= A[X][p-1];
    		X -= (L-p+1);
    	}
    	
    	if (con[X]==1 && cr[X]!=c) {
    		print(0);
    		return 0;
    	}
    	con[X] = 1;
    	cr[X] = c;
    }
    
    lli ans = 1;
    for_up (i, 1, L+1) {
    	ans *= con[i];
    	if (ans >= MOD) ans %= MOD;
    }
    
    print_lli(ans);
    
	return 0;
}