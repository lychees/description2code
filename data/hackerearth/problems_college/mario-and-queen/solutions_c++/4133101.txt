#include <bits/stdc++.h>
using namespace std;

//FILE *out =  freopen("out.txt", "w", stdout);
set< int > res;
vector< vector< char > > Q;

void printMat(vector< vector < char > > A, int N){
    for(int i=0; i<N+2; i++){
        for(int j=0; j<N+2; j++)
            cout<<A[i][j]<<" ";
        cout<<endl;
        }
}

int saveQueen(vector< vector < char > > A, int N, int p, int q, int count){

    if(A[p][q] == '0' || A[p][q] == '$')
        return 0;

    if(A[p][q] == 'Q'){
        res.insert(count);
        return 1;
    }


    //cout<<endl<<"p = "<<p<<" , q = "<<q<<" , count = "<<count<<endl;
  //  printMat(A, N);

    count += 1;

    int q1, q2, q3, q4, q5, q6, q7, q8;
    q1 = q2 = q3 = q4 = q5 = q6 = q7 = q8 = 0;

    A[p][q] = '0';

     q6 = saveQueen(A, N, p-1, q-1, count);
     q2 = saveQueen(A, N, p-1, q, count);
     q5 = saveQueen(A, N, p-1, q+1, count);
     q8 = saveQueen(A, N, p, q+1, count);
     q3 = saveQueen(A, N, p+1, q+1, count);
     q1 = saveQueen(A, N, p+1, q, count);
     q4 = saveQueen(A, N, p+1, q-1, count);
     q7 = saveQueen(A, N, p, q-1, count);

    if((q1 == 1) || (q2 == 1) || (q3 == 1) || (q4 == 1) || (q5 == 1) || (q6 == 1) || (q7 == 1) || (q8 == 1))
        return count + 1;

}

int main(){

//    FILE *in = freopen("SampleInput.txt", "r", stdin);
 //   FILE *out = freopen("SampleOutput.txt", "w", stdout);
 //   assert(in != NULL);

    long T;
    cin>>T;
    assert(T>=1 && T<=10);

    for(int h=1; h<=T; h++){

    long N;
    cin>>N;
    assert(N>=3 && N<=10);

    res.clear();
    Q.clear();

    vector < vector <char> > P(N+2, vector< char > (N+2)) ;
    for(int i=0; i<=N+1; i++){
        P[i][0] = '0';
        P[i][N+1] = '0';
        P[0][i] = '0';
        P[N+1][i] = '0';
    }

    int p,q;

    for(int i=1; i<N+1; i++)
        for(int j=1; j<N+1; j++){
            cin>>P[i][j];
            if(P[i][j] == 'M'){
                p = i;
                q = j;
            }
        }

   Q = P ;
    saveQueen(Q, N, p, q, 0);

    /* for(int i=0; i<N+2; i++){
        for(int j=0; j<N+2; j++)
            cout<<A[i][j]<<" ";
        cout<<endl;
    } */

    cout<<"Case "<<h<<": ";
    if(res.size() == 0){
        cout<<"-1";
    }
    else{

    set< int >::iterator it = res.begin();
    cout<<*it<<" < ";
    for(; it != res.end(); it++)
        cout<<*it<<" ";
    cout<<">";
    }
    cout<<endl;
    }
    return 0;
}
