#include <bits/stdc++.h>

using namespace std;

#define MOD 1000000007

int main()
{
	ios_base::sync_with_stdio(0);
	long long t;
	cin >> t;
	while (t--) {
		long long n,k;
		cin >> n >> k;
		long long grid[n+7][n+7];
		for (long long i=0;i<n;i++)	for (long long j=0;j<n;j++)	grid[i][j] = k;
		long long actions;
		cin >> actions;
		while (actions--) {
			char action;
			cin >> action;
			if (action == 'm') {
				long long x1,y1,x2,y2;
				cin >> x1 >> y1 >> x2 >> y2;
				long long s = 0;
				for (long long i=x1-1;i<x2;i++) {	
					for (long long j=y1-1;j<y2;j++) {	
						s += grid[i][j];
					}
					s %= MOD;
				}
				cout << s << endl;
			} else {
				long long x,y,z;
				cin >> x >> y >> z;
				grid[x-1][y-1] *= z;
				grid[x-1][y-1] %= MOD;
			}
		}
	}	
	return 0;
}