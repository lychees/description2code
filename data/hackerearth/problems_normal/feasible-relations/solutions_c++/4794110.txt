#include<bits/stdc++.h>
using namespace std;
#define fr(i, a, b) for(i=a; i<b; i++)
typedef pair<int, int> pii;
#define pb push_back
#define mp make_pair
#define ll long long
#define f first
#define s second
ll min(ll a, ll b){
	return (a<b)?a:b;
}
const ll inf= 9999999999LL;
vector<int> v[1000001];
vector<pii> vp;
int c=0;
int d[1000001]={};
void dfs(int u){
	if(d[u])return;
	d[u]=c;
	int z=v[u].size(), i;
	fr(i, 0, z){
		dfs(v[u][i]);
	}
}
int main(){
	int t;
	cin>>t;
	while(t--){
		int n, k, i, j, a, b, flag=0;
		string s;
		cin>>n>>k;
		vp.clear();
		fr(i, 0, n+1){
			d[i]=0;
			v[i].clear();
		}
		c=0;
		fr(i,0,  k){
			cin>>a>>s>>b;
			if(s[0]=='!'){
				vp.pb(mp(a, b));
			//	cout<<"! "<<a<<" "<<b<<endl;
			}
			else{
				v[a].pb(b);
				v[b].pb(a);
			}
		}
		fr(i, 1, n+1){
			if(d[i]==0){
				c++;
				dfs(i);
			}
		}
		fr(i, 0, vp.size()){
		//	cout<<d[vp[i].f]<<" "<<d[vp[i].s]<<endl;
			if(d[vp[i].f]==d[vp[i].s])flag=1;
		}
		if(flag)cout<<"NO\n";else cout<<"YES\n";
	}
}