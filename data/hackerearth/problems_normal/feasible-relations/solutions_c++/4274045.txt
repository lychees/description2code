#define  _CRT_SECURE_NO_WARNINGS
#include <bits/stdc++.h>

using namespace std;
int t, n, k, a, b, curid;
vector<vector<int> > G;
vector<pair<int, int> > inq;
vector<bool> vis;
vector<int> id;
string s;
void dfs(int s)
{
	vis[s] = 1;
	id[s] = curid;
	for (auto i : G[s])
		if (!vis[i])
			dfs(i);
}
int main()
{
	scanf("%d", &t);
	while (t--)
	{
		scanf("%d %d", &n, &k);
		G.assign(n + 1, vector<int>());
		vis.assign(n + 1, 0);
		id.assign(n + 1, 0);
		inq.clear();
		for (int i = 0; i < k; ++i)
		{
			cin >> a >> s >> b;
			s.size() & 1 ? G[a].push_back(b), G[b].push_back(a) : inq.push_back({ a, b });
		}
		for (int i = 1; i <= n; ++i)
			if (!vis[i])
			{
				++curid;
				dfs(i);
			}
		bool check = true;
		for (auto i : inq)
			if (id[i.first] == id[i.second])
			{
				check = false; break;
			}
		cout << ((check) ? "YES" : "NO") << endl;
	}
	//system("pause");
}