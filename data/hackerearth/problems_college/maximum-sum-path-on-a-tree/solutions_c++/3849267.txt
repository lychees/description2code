#include <bits/stdc++.h>
using namespace std;
typedef long long int ll;
ll a[50005],n,ans=0;
vector<ll>g[50005];
ll solve(ll i,ll parent)
{

	ll k=g[i].size();
	if(k==1 && g[i][0]==parent)
	{
		ans=max(ans,a[i]);
		return a[i];
	}
	ll p,first=0,second=0,r;
	for(p=0;p<k;p++)
	{
		if(g[i][p]==parent)
		continue;
		r=solve(g[i][p],i);
	    if(r>=first)
		{
			second=first;
			first=r;
		}
		else if(r>second)
		second=r;
	}
	
	ans=max(first+second+a[i],ans);
	return first+a[i];
	
}
int main()
{
  ll t,i,u,v;
  cin>>t;
  while(t--)
  {
  	cin>>n;
  	ans=0;
  	for(i=1;i<=n;i++)
  	cin>>a[i];
  	for(i=0;i<n-1;i++)
  	{
  		cin>>u>>v;
  		g[u].push_back(v);
  		g[v].push_back(u);
  	}
  	ll z=solve(1,-1);
  	cout<<ans<<endl;
  	for(i=0;i<50005;i++)
  	g[i].clear();
  }
  return 0;
}
