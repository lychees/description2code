#include <bits/stdc++.h>
#define MAX 1000100
using namespace std;
 
int A[MAX],MOD;
int main()
{
	int t;
	scanf("%d",&t);
	while(t--)
	{
	int n;
	long long  B[MAX];
	scanf("%d%d%d%d",&A[0],&A[1],&n,&MOD);
	for(int i=2;i<n;i++)
	{
		A[i]=A[i - 1] + A[i - 2];
		A[i]%=MOD;
	}
	for(int i=0;i<MOD;i++)
	  B[i]=0;
	for(int j=0;j<n;j++)
	  B[A[j]]++;
	long long ans=0;
	for(int i=0;i<MOD;i++)
	  ans+=B[i]*B[i];
	cout<<ans<<endl;
	}
	return 0;
}