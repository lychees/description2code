#include <string.h>
#include <math.h>
#include <stdlib.h>
#include <time.h>
#include <vector>
#include <set>
#include <map>
#include <algorithm>
#include <queue>
using namespace std;
const long long Mod = 1000000007LL;
long long p[1000];
long long exp(long long a,long long b,long long Mod)
{
long long ans=1,num=a;
while (b)
{
if (b%2==1) ans=ans*num%Mod;
num=num*num%Mod;
b=b/2;
}
return ans;
}
int main()
{
int T;
scanf("%d",&T);
long long eMod = exp(2,Mod-2,Mod);
while (T--)
{
long long N,P;
long long tN=N;
scanf("%lld%lld",&N,&P);
tN=N;
int tot=0;
long long ans=1;
while (N)
{
long long x=N%P;
p[tot++]=x;
x%=Mod;
ans=(ans*(x+1))%Mod;
N/=P;
}
ans=(tN+1-ans)%Mod;
if (ans<0) ans+=Mod;
if (tN%2==0)
{
long long Num=tN/2;
int cnt=0;
bool ok=false;
while (Num)
{
long long x=Num%P;
if (x>p[cnt])
{
ok=true;
break;
}
Num/=P;
cnt++;
}
if (ok) ans++;
}
ans=ans*eMod%Mod;
printf("%lld\n",ans);
}
return 0;
}