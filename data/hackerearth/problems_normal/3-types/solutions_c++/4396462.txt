//Sinha Saab
//NARUTO Fan



#include <cstdio>
#include <iostream>
#include <algorithm>
#include <string.h>
#include <vector>
#include <set>
#include <map>
#include <queue>
#include <list>
#include <math.h>

#define ll long long int
#define maxN 1000
#define maxVal 100000000
#define minVal -100000000
#define mod 1000000007LL

#define gcd(a,b) __gcd(a,b)

using namespace std;

int n,m;
vector<pair<int,pair<int,int> > > g;
int female[maxN+5],male[maxN+5];

int getf(int i)
{
	if(i!=female[i])
		female[i]=getf(female[i]);
	return female[i];
}

int getm(int i)
{
	if(i!=male[i])
		male[i]=getm(male[i]);
	return male[i];
}

int main()
{
	ios_base::sync_with_stdio(false);
    cin.tie(NULL);
    #ifndef LOCAL_SYS
        //freopen("in.txt","r",stdin);
        //freopen("out.txt","w",stdout);
    #endif
    int i,ans=0,u,v,w,x,y,z;
    cin>>n>>m;
    for(i=1;i<=n;i++)
    	female[i]=male[i]=i;
    while(m--)
    {
    	cin>>u>>v>>w;
    	if(w==3)
    		w=0;	//both men and women
    	else if(w==2)
    		w=1;	//only women
    	else
    		w=2;	//only men
    	g.push_back(make_pair(w,make_pair(u,v)));
    }
    sort(g.begin(),g.end());
    for(i=0;i<(int)g.size();i++)
    {
    	w=g[i].first;
    	u=g[i].second.first;
    	v=g[i].second.second;
    	z=0;
    	if(w==0)
    	{
    		//both men and women
    		x=getf(u);
    		y=getf(v);
    		if(x!=y)
    		{
    			female[x]=y;
    			z=1;
    		}
    		x=getm(u);
    		y=getm(v);
    		if(x!=y)
    		{
    			male[x]=y;
    			z=1;
    		}
    	}
    	else if(w==1)
    	{
    		//only women
    		x=getf(u);
    		y=getf(v);
    		if(x!=y)
    		{
    			female[x]=y;
    			z=1;
    		}
    	}
    	else
    	{
    		//only men
    		x=getm(u);
    		y=getm(v);
    		if(x!=y)
    		{
    			male[x]=y;
    			z=1;
    		}
    	}
    	if(z)
    		ans++;
    }
    ans=(int)g.size()-ans;
    x=y=0;
    for(i=1;i<=n;i++)
    {
    	if(female[i]==i)
    		x++;
    	if(male[i]==i)
    		y++;
    }
    if(x!=1||y!=1)
    	ans=-1;
    printf("%d\n",ans);
    return 0;
}