#include<iostream>
#include<algorithm>
using namespace std;
main()
{
int t;
cin>>t;
for(int z=0;z<t;z++)
{
long long ar[10000002]; long long n; long long mod;
cin>>ar[0]>>ar[1]>>n>>mod;
for(long i=2;i<n;i++)
{
  ar[i]=(ar[i-1]+ar[i-2])%mod;
}
long long br[10000002];
for(long i=0;i<mod;i++)
br[i]=0;
long long int ans=0;
for(long i=0;i<n;i++)
{
  br[ar[i]]++;
}
for(long i=0;i<mod;i++)
ans=ans+br[i]*br[i];
cout<<ans<<endl;
}
}
