#include<bits/stdc++.h>

#define ll long long
#define in(X) scanf("%lld",&X)
#define mod 1000000007
using namespace std;

int main()
{
	ll d,n,k,a,i,j,sum,x1,y1,x2,y2,x,y,z;
	in(d);
	while(d--)
	{
		in(n);
		in(k);
		ll ar[1001][1001];
		for(i=0;i<n;i++)
			for(j=0;j<n;j++)
				ar[i][j] = k;
		in(a);
		char ch;
		while(a--)
		{
			cin>>ch;
			if(ch=='m')
			{
				cin>>x1>>y1>>x2>>y2;
				sum = 0;
				for(i=x1-1;i<x2;i++)
					for(j = y1-1;j<y2;j++)
						sum+=ar[i][j];
				printf("%lld\n",sum%mod);
			}
			else
			{
				cin>>x>>y>>z;
				ar[x-1][y-1] = (ar[x-1][y-1]* z)%mod;
			}
		}	
	}
	return 0;
}