#include <iostream>
using namespace std;
#include<bits/stdc++.h>
int main()
{
	long long t;
	cin>>t;
	while(t--){
		long long x,y,n,mod;
		map<long long,long long> mp;
		vector<long long> dp(1000001,0);
		cin>>x>>y>>n>>mod;
		vector<long long> a(n,0);
		a[0]=x;
		a[1]=y;
			/*if(mp.find(a[0])==mp.end()){
				mp.insert(make_pair(a[0],1));
			}
				if(mp.find(a[1])==mp.end()){
				mp.insert(make_pair(a[1],1));
			}
			else{
				mp[a[1]]++;
			}*/
			dp[a[0]]++;
			dp[a[1]]++;
		for(long long i=2;i<n;i++){
			a[i]=(a[i-1]+a[i-2])%mod;
			dp[a[i]]++;
		}
		//sort(a.begin(),a.end());
		//for(auto x: a){
		//	cout<<x<<endl;
		//}
		long long sum=0;
		//long long prev=a[0];
		//long long c=1;
		for(auto x:dp){
			sum+=x*x;
			
		}
		//sum+=c*c;
		cout<<sum<<endl;
		
	}
    //cout << "Hello World!" << endl;
    return 0;
}
