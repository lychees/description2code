for i in xrange(0,int(raw_input())):
	a=int(raw_input())
	b=map(int,raw_input().split())
	back=[b[0]]
	current=b[0]
	for i in b:
		if i>current:
			current=i
		back.append(current)
	d=[0 for i in xrange(0,a+1)]
	j=a-1
	for i in b[::-1]:
		d[j]=max(d[j+1],i)
		j-=1
	result=0
	for i in xrange(1,a-1):
		if back[i]==back[i+1] and b[i]<d[i]:
			result=(result+min(back[i],d[i])-b[i])%1000000007
	print result