#include<iostream>
using namespace std;
#include<set>
int main()
 {
 	int t;
 	cin>>t;
   
 	
 	while(t--)
 	  {int n,i,j;
 	  	cin>>n;
 	  	int a[52][5]={{0}};
 	  	
 	  	for(i=0;i<n;i++)
 	  	  {int x,y;
 	  	    char ch;
 	  	  	cin>>x>>y>>ch;
 	  	  	if(ch=='N')
 	  	  	   {a[i][2]=0;
 	  	  	    a[i][3]=1;
 	  	  	   }
 	  	  	else if(ch=='S')
 	  	  	  {a[i][2]=0;
 	  	  	    a[i][3]=-1;
 	  	  	   }
 	  	  	else if(ch=='W')
 	  	  	  {a[i][2]=-1;
 	  	  	    a[i][3]=0;
 	  	  	   }
 	  	   else
 	  	  	  {a[i][2]=1;
 	  	  	   a[i][3]=0;
 	  	  	  }
 	  	  	a[i][0]=x;
 	  	  	a[i][1]=y;
 	  	  	
 	  	  }
 	  	set<pair<int,int> > s;
 	  	set<pair<int,int> > s2;
 	  	int G;
 	  	for(G=0;G <=3000;G++)
 	  	  {int k;
 	  	  	for(j=0;j<n;j++)
 	  	  	  {for(k=0;k<n;k++)
 	  	  	      {
 	  	  	      	if(a[j][4]==0 && a[k][4]==0 && a[j][2]==1 && a[k][2]==-1)
 	  	  	      	    {
 	  	  	      	    	if(a[j][1]==a[k][1] && a[j][0]==a[k][0]-1)
 	  	  	      	    	    {a[j][4]=1;
 	  	  	      	    	     a[k][4]=1;
 	  	  	      	    	    }
 	  	  	      	    }
 	  	  	      	    
 	  	  	      	else if(a[j][4]==0 && a[k][4]==0 && a[j][3]==1 && a[k][3]==-1)
 	  	  	      	  {
 	  	  	      	  	if(a[j][0]==a[k][0] && a[j][1]==a[k][1]-1)
 	  	  	      	    	    {a[j][4]=1;
 	  	  	      	    	     a[k][4]=1;
 	  	  	      	    	    }
 	  	  	      	  }
 	  	  	      }
 	  	  	  }
 	  	  	s.clear();
		    s2.clear();
 	  	  	for(i=0;i<n;i++)
 	  	  	  {
 	  	  	  	if(a[i][4]==0)
 	  	  	  	   {
 	  	  	  	   	 a[i][0]+=a[i][2];
 	  	  	  	   	 a[i][1]+=a[i][3];
 	  	  	  	   	 if(s.find(make_pair(a[i][0],a[i][1]))==s.end())
 	  	  	  	   	    s.insert(make_pair(a[i][0],a[i][1]));
			         else
			            s2.insert(make_pair(a[i][0],a[i][1]));
 	  	  	  	   }
 	  	  	  }
 	  	  	for(j=0;j<n;j++)
 	  	  	  {for(set<pair<int,int> >::iterator it=s2.begin();it!=s2.end();it++)
 	  	  	     if(it->first==a[j][0] && it->second==a[j][1])
 	  	  	         {
 	  	  	         a[j][4]=1;//cout<<j<<endl;
 	  	  	        }
 	  	  	  }
 	  	  	
 	  	  }
 	  	int count=0;
 	  	for(i=0;i<n;i++)
 	  	  if(a[i][4]==0)
 	  	    count++;
 	  	    cout<<count<<endl;
 	  }
 	
 }