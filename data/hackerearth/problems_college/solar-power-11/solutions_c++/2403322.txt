#include<bits/stdc++.h>
#define MOD 1000000007
using namespace std;
typedef long long int ll;
ll arr[2000][2000];
ll BIT[2000][2000];
void init(int n,ll k)
{
    for(int i=0;i<n;i++)
    for(int j=0;j<n;j++)
    {
        BIT[i][j]=0;
        arr[i][j]=k;
    }
}
void update(int ind_x,int ind_y,ll val,int n)
{
    for(int i=ind_x;i<n;i=(i|(i+1)))
    for(int j=ind_y;j<n;j=(j|(j+1)))
    {
        BIT[i][j]+=val+MOD;
        BIT[i][j]%=MOD;
    }
}
ll sum(int ind_x,int ind_y)
{
    ll ans=0;
    for(int i=ind_x;i>=0;i=(i&(i+1))-1)
    for(int j=ind_y;j>=0;j=(j&(j+1))-1)
    {
        ans+=BIT[i][j];
        ans%=MOD;
    }
    return ans;
}
int main()
{
    int test,n;
    ll k;
    scanf("%d",&test);
    while(test--)
    {
        scanf("%d%lld",&n,&k);
        init(n,k);
        int a;
        scanf("%d",&a);
        for(int i=0;i<n;i++)
            for(int j=0;j<n;j++)
                update(i,j,k,n);
        while(a--)
        {
            int x1,y1,x2,y2;
            char str[10];
            scanf("%s",str);
            if(str[0]=='m')
            {
                scanf("%d%d%d%d",&x1,&y1,&x2,&y2);
                x1--;
                y1--;
                x2--;
                y2--;
                ll ans=0;
                ans=sum(x2,y2);
                ans+=sum(x1-1,y1-1);
                ans-=sum(x2,y1-1);
                ans-=sum(x1-1,y2);
                while(ans<0)
                    ans+=MOD;
                printf("%lld\n",ans);
            }
            else
            {
                ll val;
                scanf("%d%d%lld",&x1,&y1,&val);
                x1--;
                y1--;
                ll tmp=val;
                ll fin=(val*arr[x1][y1])%MOD;
                val=fin-arr[x1][y1];
                arr[x1][y1]=fin;
                update(x1,y1,val,n);
            }
        }
    }
}

