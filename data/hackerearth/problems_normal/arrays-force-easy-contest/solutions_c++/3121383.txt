#include <bits/stdc++.h>
using namespace std;

#define MAXN 1000010
#define MOD 1000000007LL
#define ll long long
int A[MAXN];

int main()
{
	int t,n,a,b,c,m;
	cin >> t;
	while(t--)
	{
		cin >> a >> b >> n >> m;
		memset(A,0,sizeof A);
		++A[a];
		++A[b];
		for(int i=2;i<n;++i)
		{
			c = (a+b)%m;
			++A[c];
			a = b;
			b = c;
		}
		ll res = 0;
		for(int i=0;i<MAXN;++i)
			res += 1LL*A[i]*A[i];
		cout << res << endl;
	}
	return 0;
}