#include <iostream>
#include <algorithm> 
#include <vector>
using namespace std;

int main()
{
    long T, a0, a1, N, MOD;
    cin >> T;
    while(T--)
    {
    	long sum = 0;
    	cin >> a0 >> a1 >> N >> MOD;
    	long* list = new long[MOD];
    	vector <long> numbers;
    	
    	for (long m = 0; m < MOD; m++)
    	{
    		list[m] = 0;
    	}
		
    	numbers.push_back(a0);
    	numbers.push_back(a1);
    	long val = 0;
    	
    	for (long n = 2; n < N; n++)
    	{
    		val = (numbers[n - 1] + numbers[n - 2]) % MOD;
    		numbers.push_back(val);
    		list[val] += 1;
    	}
		for (long m = 0; m < MOD; m++)
		{
			
			if (a0 == m)
			{
				list[m] += 1;
			}
			if (a1 == m)
			{
				list[m] += 1;
			}
				
			sum += (list[m] * list[m]);
		
		}
    	cout << sum << endl;
    	
    }
    return 0;
}
