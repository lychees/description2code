#include<bits/stdc++.h>

using namespace std;

void unionize(int [],int,int);
int root(int [],int);
int main()
{


    int test;
    cin>>test;

    for(int i=0;i<test;i++)
    {
    int n,k;
    bool flag=false;

    cin>>n>>k;
    int arr[n+1];

vector<pair<int,int> > note;

 for(int j=0;j<n+1;j++)
 {
  arr[j]=j;

 }
    for(int j=0;j<k;j++)
{
int a,b;
string c;
cin>>a;
cin>>c;
cin>>b;
if(c== "=")
    {

    unionize(arr,a,b);
    }
else
note.push_back(make_pair(a,b));

}

while(!note.empty())
{
if(root(arr,note.back().first)==root(arr,note.back().second))
{
flag=true;
cout<<"NO\n";
break;
}
note.pop_back();
}




if(!flag)
cout<<"YES\n";

note.clear();
}

return 0;






}

int root(int arr[],int i)
{


while(arr[i]!=i)
{

arr[ i ] = arr[ arr[ i ] ] ;
i = arr[ i ];

}
return i;

}
void unionize(int arr[],int a,int b)
{

int root_a=root(arr,a);
int root_b=root(arr,b);


arr[root_a]=arr[root_b];

}
