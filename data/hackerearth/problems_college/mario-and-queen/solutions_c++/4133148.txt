#include<bits/stdc++.h>
using namespace std;
char arr[15][15];
int n;
set<int>s;
set<int>::iterator it;
void f(int x,int y,int co,int vis[15][15])
{
	int a,b,c,d,e,p,q,r,t;
	if(arr[x][y]=='Q')
	{
		s.insert(co);
		return;
	}
	if(arr[x][y]=='$')
	return;
	vis[x][y]=1;
	if(x+1<n&&arr[x+1][y]!='M'&&vis[x+1][y]!=1)
	{
		f(x+1,y,co+1,vis);
	}
	if(x+1<n&&y+1<n&&arr[x+1][y+1]!='M'&&vis[x+1][y+1]!=1)
	{
		f(x+1,y+1,co+1,vis);
	}
	if(x+1<n&&y-1>=0&&arr[x+1][y-1]!='M'&&vis[x+1][y-1]!=1)
	{
		f(x+1,y-1,co+1,vis);
	}
	if(x-1>=0&&y-1>=0&&arr[x-1][y-1]!='M'&&vis[x-1][y-1]!=1)
	{
		f(x-1,y-1,co+1,vis);
	}
	if(x-1>=0&&y+1<n&&arr[x-1][y+1]!='M'&&vis[x-1][y+1]!=1)
	{
		f(x-1,y+1,co+1,vis);
	}
	if(x-1>=0&&arr[x-1][y]!='M'&&vis[x-1][y]!=1)
	{
		f(x-1,y,co+1,vis);
	}
	if(y+1<n&&arr[x][y+1]!='M'&&vis[x][y+1]!=1)
	{
		f(x,y+1,co+1,vis);
	}
	if(y-1>=0&&arr[x][y-1]!='M'&&vis[x][y-1]!=1)
	{
		f(x,y-1,co+1,vis);
	}
	vis[x][y]=0;
}
int main()
{
	int t;
	int k=1;
	scanf("%d",&t);
	while(t--)
	{
		scanf("%d",&n);
		int i,j;
		int x,y;
		for(i=0;i<n;i++)
		{
			for(j=0;j<n;j++)
			cin>>arr[i][j];
		}
		for(i=0;i<n;i++)
		{
			for(j=0;j<n;j++)
			{
				if(arr[i][j]=='M')
				{
					x=i;
					y=j;
					break;
				}
			}
		}
		s.clear();
		int vis[15][15];
		for(i=0;i<n;i++)
		{
			for(j=0;j<n;j++)
			vis[i][j]=0;
		}
		f(x,y,0,vis);
		printf("Case %d: ",k++);
		if(s.size()==0)
		printf("-1\n");
		else
		{
			int x=*(s.begin());
			printf("%d ",x);
			printf("< ");
			for(it=s.begin();it!=s.end();it++)
			cout<<*it<<" ";
			printf(">\n");
		}
	}
}
