#include <bits/stdc++.h>
using namespace std;

int main()
{
	float t, n, i, j, k, c, y, x, f, g, q;
	float w;
	char d;
	cin >> t;
	while (t--)
	{
		vector<pair<pair<float, float>, char> > a;
		cin >> n;
		q = 4009;
		a.clear();
		c = n;
		g = 0;
		for (i = 0; i<n; i++)
		{
			cin >> x >> y >> d;
			a.push_back(make_pair(make_pair(x, y), d));
		}
		for (w = 0; w<2002; w = w + 0.5)
		{
			for (j = 0; j<n; j++)
			{
				f = 0;
				for (k = j + 1; k<n; k++)
				{
					// cout<<a[j].first.first<<" "<<a[j].first.second<<" "<<a[k].first.first<<" "<<a[k].first.second<<endl;
					if (a[j].first == a[k].first)
					{
						c--;
						f = 1;
						//	cout<<a[j].first.first<<" "<<a[j].first.second<<endl;
						//	cout<<c<<endl;
						a[k].first.first = q++;
						a[k].second = 'p';
					}
				}
				if (f == 1)
				{
					g++;
					a[j].first.first = q++;
					a[j].second = 'p';
				}
			}
			for (j = 0; j<n; j++){
				if (a[j].second == 'N')
					a[j].first.second = a[j].first.second + 0.5;
				else if (a[j].second == 'S')
					a[j].first.second = a[j].first.second - 0.5;
				else if (a[j].second == 'E')
					a[j].first.first = a[j].first.first + 0.5;
				else if (a[j].second == 'W')
					a[j].first.first = a[j].first.first - 0.5;
				else;
			}
		}
		cout << c - g << endl;
	}
}