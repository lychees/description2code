#include <bits/stdc++.h>
using namespace std;
typedef vector< int > vi;
typedef vector< vi > vii;
vii adj(1000002);
vi visited,cc;
string sr;
int n,k,z;
vector< pair< int,int > > bded;
void dfs(int s,int d)
{
  visited[s] = 1;
  cc[s] = d;
  for (int i = 0; i < adj[s].size(); ++i)
  {
    if(!visited[adj[s][i]])
      dfs(adj[s][i],d);
  }
}
int main()
{
  int t;
  cin>>t;
  while(t--)
  {
      z = 0;   
      sr = "YES";
      cin>>n>>k;
      visited.clear();
      cc.clear();
      bded.clear();
      for (int i = 0; i <= n ; ++i)
      {
        adj[i].clear();
        visited.push_back(0);
        cc.push_back(0);
      }

      for (int i = 0; i < k; ++i)
      {
        int p,q;
        string str;
        cin>>p>>str>>q;
        if(!str.compare("="))
        {
          adj[p].push_back(q);
          adj[q].push_back(p);
        }
        else
        {
          bded.push_back(make_pair(p,q));
        }
      }
      for (int i = 0; i <=n ; ++i)
      {
        if(!visited[i])
          dfs(i,i);
      }
      for (int i = 0; i < bded.size(); ++i)
      {
        int x = bded[i].first;
        int y = bded[i].second;
        if(cc[x]==cc[y])
        {
          sr = "NO";
          break;
        }

      }
      cout<<sr<<endl;
    }

}