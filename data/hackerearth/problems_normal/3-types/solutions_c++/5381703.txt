#include<bits/stdc++.h>
using namespace std;
#define rep(i,n) for(int (i)=1;(i)<=(n);(i)++)
int arr[1000000];
int man[1000000];
int wom[1000000];
vector<pair<int,pair<int,int> > > v;
void init(int n)
{
	rep(i,n)
	{
		arr[i]=i;
		man[i]=i;
		wom[i]=i;
	}
}
int root(int x,int arr[])
{
	while(x!=arr[x])
	{
		arr[x]=arr[arr[x]];
		x=arr[x];
	}
	return x;
}
void unin(int x,int y,int arr[])
{
	arr[x]=y;
}
int main(void)
{
	int n,m;cin>>n>>m;
	init(n);
	int a;int b;int c;int count=0;int count1=0;int count2=0;int ans=0;
	while(m--)
	{
		cin>>a>>b>>c;
		if(c==3)
		{
			int roota=root(a,arr);
			int rootb=root(b,arr);
			if(roota!=rootb)
			{
				unin(roota,rootb,arr);
				count++;
			}
			else
			{
				ans++;
			}
		}
		if(c==1)
		count1++;
		if(c==2)
		count2++;
		if(c==1 || c==3)
		{
			int roota=root(a,man);
			int rootb=root(b,man);
			if(roota!=rootb)
			{
				unin(roota,rootb,man);
			}
		}
		if(c==2 || c==3)
		{
			int roota=root(a,wom);
			int rootb=root(b,wom);
			if(roota!=rootb)
			{
				unin(roota,rootb,wom);
			}
		}
	}
	set <int> s1;
	set <int> s2;
	rep(i,n)
	{
		s1.insert(root(man[i],man));
		s2.insert(root(wom[i],wom));
	}
	int total=2*(n-1);
	int r=n-1-count;
	if(r>count1 || r>count2 || s1.size()>1 || s2.size()>1)
	{
		cout<<"-1"<<endl;
	}
	else
	{
		cout<<ans+count1+count2-2*r<<endl;
	}
	return 0;
}