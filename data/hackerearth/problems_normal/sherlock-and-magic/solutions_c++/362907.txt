#include<cstdio>
#include<iostream>
#include<vector>
#include<map>
#include<stack>
#include<queue>
#include<cmath>
#include<climits>
#include<algorithm>
#include<cstdlib>
#include<cstring>
#include<queue>
using namespace std;
//bool pos[1000][1000][50];
int tx[50][5000];
int ty[50][5000];
int main()
{
int T;
int N;
//scanf("%d",&T);
cin>>T;
int i,j,k;
int x[50];
int y[50];
int sx[50];
int sy[50];
int p[50];
int val[50];
while(T--)
	{
	cin>>N;
	char c;
	int mt=0;
	for(i=0;i<N;i++)
		{
		cin>>x[i]>>y[i]>>c;
		if(c=='N')
			{
			sy[i]=1;
			sx[i]=0;
			}	
		else if(c=='S')
			{
			sy[i]=-1;
			sx[i]=0;	
			}
		else if(c=='W')
			{
			sy[i]=0;
			sx[i]=-1;
			}
		else 
			{
			sy[i]=0;
			sx[i]=1;
			}
		val[i]=1;
		int curx=2*x[i];
		int cury=2*y[i];
		int st=0;
		while(curx>=-2000 && curx<=2000 && cury>=-2000 && cury<=2000)
			{
			tx[i][st]=curx;
			ty[i][st]=cury;
			st++;
			curx+=sx[i];
			cury+=sy[i];
			}
//		tx[i][st]=100000;
		p[i]=st-1;
		mt=max(mt,p[i]);
		}
	int ans=N;
	for(i=1;i<=mt;i++)
		{
		vector<int> pp;
		for(j=0;j<N;j++)
			{
			if(p[j]<i)
				continue;
			if(val[j]==0)
				continue;
			for(k=j+1;k<N;k++)
				{
				if(p[k]<i)
					continue;
				if(val[k]==0)
					continue;
				if(tx[j][i]==tx[k][i] && ty[j][i]==ty[k][i])
					{
				//	cout<<tx[j][i]<<":"<<ty[j][i]<<endl;
					pp.push_back(j);
					pp.push_back(k);
					}
				}
			}
		for(j=0;j<pp.size();j++)
			{
	//		cout<<"i"<<i<<endl;
//			cout<<pp[j]<<endl;
				val[pp[j]]=0;
			}
		}
	ans=0;
	for(i=0;i<N;i++)
		if(val[i]==1)
			ans++;
	cout<<ans<<endl;
	}
return 0;
}