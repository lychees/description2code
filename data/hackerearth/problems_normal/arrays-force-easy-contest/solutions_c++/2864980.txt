#include <iostream>
#include <bits/stdc++.h>

using namespace std;
#define N 1000003

int arr[N];
int inp[N];

int main()
{
 	int t;
 	cin>>t;
 	while(t--)
 	{
 		memset(arr , 0 ,sizeof arr);
 		memset(inp , 0 , sizeof inp);
 		
 		int mod,ele1,ele2,n;
 		cin>>inp[0]>>inp[1]>>n>>mod;
 	
 		arr[inp[0]]++;
 		arr[inp[1]]++;
 	
 		for(int i=2;i<n;i++)
 		{
 			inp[i] = (inp[i-1] + inp[i-2])%mod;
 			arr[inp[i]]++;
 		}
 		
 		long long ans = 0;
 	
 		for(int i=0;i<mod;i++)
 		{
 			ans += pow(arr[i],2);
 		}
 		cout<<ans<<endl;
 	
 	}
    return 0;
}
