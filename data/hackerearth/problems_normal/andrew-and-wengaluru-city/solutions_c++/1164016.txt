#include <iostream>
#define ll long long int
#define MOD 1000000007
#include<bits/stdc++.h>
using namespace std;
	ll a[1000009],n,max_l[1000009],max_r[1000009];
int main()
{
	int i,t;

   	cin>>t;
   	while(t--)
   	{
   		ll ans=0;
   		cin>>n;
   		for(i=0;i<n;i++)
   		{
   			cin>>a[i];
   		}
   		if(n==0||n==1)
        {
            printf("0\n");
            continue;
        }
   		int ct=0;
   		max_l[0]=a[0];
   		max_r[n-1]=a[n-1];
   		for(i=1;i<n;i++)
        {
            if(a[i]>max_l[i-1])
                max_l[i]=a[i];
            else
                max_l[i]=max_l[i-1];
        }
        for(i=n-2;i>=0;i--)
        {
            if(a[i]>max_r[i+1])
                max_r[i]=a[i];
            else
                max_r[i]=max_r[i+1];
        }

   		for(i=1;i<n-1;i++)
   		{

            if(a[i]<min(max_r[i+1],max_l[i-1]))
                ans=(ans+(min(max_r[i+1],max_l[i-1])-a[i]))%MOD;
   		}
   		cout<<ans<<endl;
   		//t--;
   	}
    return 0;
}
