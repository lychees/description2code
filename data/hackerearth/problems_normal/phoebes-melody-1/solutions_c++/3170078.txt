#include<bits/stdc++.h>
using namespace std;
const int INF=1e9+3;
const int MAXN = 2e5+3;
int hL[MAXN],hR[MAXN];
int ar[MAXN];
int main() {
	int t;
	cin>>t;
	while(t--) {
		stack<int> st;
		int n,k;
		cin>>n>>k;
		for(int i=1;i<=n;i++) {
			scanf("%d",&ar[i]);
			while(!st.empty() and ar[st.top()]>ar[i])
				st.pop();
			if(st.empty())
				hL[i]=-1;
			else
				hL[i]=st.top();
			st.push(i);
		}
		while(!st.empty())
			st.pop();
		for(int i=n;i>=1;i--) {
			while(!st.empty() and ar[st.top()]>ar[i])
				st.pop();
			if(st.empty())
				hR[i]=-1;
			else
				hR[i]=st.top();
			st.push(i);
		}
		long long ans=0;
		for(int i=1;i<=n;i++) {
			int val=INF;
			int lft=i-k;
			while(lft>=1 and ar[lft]>ar[i])
				lft=hL[lft];
			if(lft>=1)
				val=min(val,abs(lft-i));
			int rght=i+k;
			while(rght!=-1 and rght<=n and ar[rght]>ar[i])
				rght=hR[rght];
			if(rght!=-1 and rght<=n)
				val=min(val,abs(rght-i));
			if(val!=INF)
				ans+=val;
		}
		cout<<ans<<endl;
	}
	return 0;
}