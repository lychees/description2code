#include <bits/stdc++.h>
#define ull long long
#define MOD 1000000007
using namespace std;

ull a[1005][1005];
ull b[1005][1005];
ull n,k;

ull sum(ull x,ull y)
{
	ull s = 0;
	for (ull i = x; i >= 0;)
	{
        for (ull j = y; j >= 0;) 
        {
        	//cout<<j<<endl;
        	//cout<<"here2"<<endl;
            s += b[i][j];
            s = s%MOD;
            j = (j & (j + 1)) - 1;
        }
        i = (i & (i + 1)) - 1;
    }
    return s;
}
   
void update(ull x,ull y,ull z)
{
	for (ull i = x; i < n;)
	{
        for (ull j = y; j < n; ) 
        {
                b[i][j] += z;
                b[i][j] = b[i][j]%MOD;
                j = j | (j + 1);
        }
        i = i | (i + 1);
    }
}

int main()
{
    ull t;
    cin>>t;
    while(t--)
    {
    	//int n;
    	cin>>n>>k;
    	//int a[n][n];
    	for(ull i=0;i<n;i++)
    	{
    		for(ull j=0;j<n;j++)
    		{
    			a[i][j] = k;
    			b[i][j] = 0;
    		}
    	}
    	
    	for (ull i = 0; i < n; i++) {
            for (ull j = 0; j < n; j++) {
                update(i, j, a[i][j]);
            }
        }
    	
    	ull c;
    	cin>>c;
    	while(c--)
    	{
    		//cout<<"here"<<endl;
    		char temp;
    		cin>>temp;
    		if(temp == 'm')
    		{
    			ull x1,y1,x2,y2;
    			cin>>x1>>y1>>x2>>y2;
    			x1--;y1--;x2--;y2--;
    			ull s1 = sum(x2,y2);
    			ull s2 = sum(x2,y1-1);
    			ull s3 = sum(x1-1,y2);
    			ull s4 = sum(x1-1,y1-1);
    			cout<<(s1-s2-s3+s4)<<endl;
    		}
    		else
    		{
    			ull x,y,z;
    			cin>>x>>y>>z;
				x--;y--;
				z = z*a[x][y];
				update(x,y,z-a[x][y]);
				a[x][y] = z%MOD;
    		}
    	}
    	
    }
    return 0;
}
