#include<bits/stdc++.h>
using namespace std;
#define ll long long int
ll arr[1000100],bestleft[1000100],bestright[1000100];
int main()
{
	ll t;
	scanf("%lld",&t);
	while(t--)
	{
			ll n,k;
	scanf("%lld %lld",&n,&k);
	ll i;
	for(i=1; i<=n; i++)
	{
		scanf("%lld",&arr[i]);
		bestleft[i]=i-1;
		bestright[i]=i+1;
	}
	ll curr;
	for(i=1; i<=n; i++)
	{
		curr=i-1;
		while(curr>=1 && arr[i]<=arr[curr])
		{
			curr=bestleft[curr];
		}
		bestleft[i]=curr;
	}
	for(i=n; i>=1; i--)
	{
		curr=i+1;
		while(curr<=n && arr[i]<=arr[curr])
		{
			curr=bestright[curr];
		}
		bestright[i]=curr;
	}
	ll ans=0;
	for(i=1; i<=n; i++)
	{
		ll left,right;
		left=i-k;
		right=i+k;
		ll val=INT_MAX;
		while(left>=1 && arr[i]<=arr[left]) left=bestleft[left];
		while(right<=n && arr[i]<=arr[right]) right=bestright[right];
		if(left>=1 && left<=i-k) val=min(val,abs(i-left));
		if(right<=n && right>=i+k) val=min(val,abs(right-i));
		if(val!=INT_MAX) ans+=val;
	}
	printf("%lld\n",ans);		
		
	}
	
	return 0;
}