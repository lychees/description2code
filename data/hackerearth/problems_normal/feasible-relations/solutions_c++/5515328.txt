#include<bits/stdc++.h>
using namespace std;
#define mod 1000000007
#define pi 3.141593
#define pb push_back
#define mp make_pair
typedef long long ll;
int main()
{
	ios_base::sync_with_stdio(false);
	ll t;
	cin>>t;
    while(t--)
    {
    	ll n,m;
    	cin>>n>>m;
    	ll i;
    	string sign;
    	vector<ll> v[n+1];
    	vector<pair<ll,ll> > inequality;
    	for(i=0;i<m;i++)
    	{
    		ll a,b;
    		cin>>a>>sign>>b;
    		if(sign=="=")
    		{
    			v[a].pb(b);
    			v[b].pb(a);
			}
			else if(sign=="!=")
			{
				inequality.pb(mp(a,b));
			}
		}
		ll j;
		ll value[n+1];
		ll id=1;
		bool visit[n+1];
		memset(visit,false,sizeof(visit));
		for(i=1;i<=n;i++)
		{
			if(!visit[i])
			{
				stack<ll> s;
			    s.push(i);
			    visit[i]=true;
			    value[i]=id;
			    while(!s.empty())
			   {
				   ll p=s.top();
				   s.pop();
				   for(j=0;j<v[p].size();j++)
				   {
					  if(!visit[v[p][j]])
					  {
						visit[v[p][j]]=true;
						value[v[p][j]]=id;
						s.push(v[p][j]);
					  }
				    }
			    }
			    id++;
			}
		}
		bool ans=true;
		for(i=0;i<inequality.size();i++)
		{
			ll a,b;
			a=inequality[i].first;
			b=inequality[i].second;
			if(value[a]==value[b])
			{
				ans=false;
				break;
			}
		}
		if(ans)
		{
			cout<<"YES\n";
		}
		else 
		{
			cout<<"NO\n";
		}
	}
    return 0;
}


