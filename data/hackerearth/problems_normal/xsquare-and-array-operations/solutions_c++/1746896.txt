#include <iostream>
#include <algorithm>
#include <vector>
#include <cstdio>
#include <stack>
using namespace std;

int N;
int A[500013];
int a[500013];
int b[500013];
stack<int> solve;

int main() {
	int T;
	scanf("%d",&T);
	for (int t=0;t<T;t++) {
		scanf("%d",&N);
		for (int i=0;i<N;i++) scanf("%d",&A[i]);
		for (int i=0;i<N;i++) a[i] = N;
        for (int i=0;i<N;i++) b[i] = -1;
        while (solve.size()>0) solve.pop();
        for (int i=N-1;i>=0;i--) {
            while (solve.size()>0 && A[i]>=A[solve.top()]) {
                b[solve.top()] = i;
                solve.pop();
            }
            solve.push(i);
        }
        while (solve.size()>0) solve.pop();
        for (int i=0;i<N;i++) {
            while (solve.size()>0 && A[i]>A[solve.top()]) {
                a[solve.top()] = i;
                solve.pop();
            }
            solve.push(i);
        }
        long long ans = 0;
        for (int i=0;i<N;i++) {
        	if (a[i]==N && b[i]==-1) continue;
        	else if (a[i]==N) ans+=A[b[i]];
        	else if (b[i]==-1) ans+=A[a[i]];
        	else ans+=min(A[a[i]],A[b[i]]);
        }
        printf("%lld\n",ans);
	}
	
    return 0;
}
