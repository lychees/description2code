#include <iostream>
using namespace std;

int main()
{
    long long n,z,t,a1,a2,mod,x;
    cin>>t;
    for(z=1;z<=t;z++)
    {
    	cin>>a1>>a2>>n>>mod;
    	long long b[mod];
    	for(long long k=0;k<mod;k++)
    		b[k]=0;
    	b[a1]++;
    	b[a2]++;
    	long long i=0;
    	while(i!=n-2)
    	{
    		x=(a1+a2)%mod;
    		b[x]++;
    		a1=a2;
    		a2=x;
    		i++;
    	}
    	long long sum=0;
    	for(long m=0;m<mod;m++)
    	{
    		sum+=(b[m]*b[m]);
    	}
    	cout<<sum<<endl;
    }
    return 0;
}
