#include <iostream>
#include <cmath>

using namespace std;

long long int sol;
int n,m,k;
char mat[8][8];
bool cine[8][8];
bool viz[8][8];
int dx[4]={1,-1,0,0};
int dy[4]={0,0,1,-1};
int cate;

void dfs(int x,int y,int cul)
{
    int i,nx,ny;
    for(i=0;i<4;i++)
    {
        nx=x+dx[i];
        ny=y+dy[i];
        if(nx>=0 && nx<n)
            if(ny>=0 && ny<m)
                if(cine[nx][ny]==cul)
                if(!viz[nx][ny])
                {
                    cate++;
                    viz[nx][ny]=1;
                    dfs(nx,ny,cul);
                }
    }
}

bool verif()
{
    int i,j;
    for(i=0;i<n;i++)
        for(j=0;j<m;j++)
            viz[i][j]=0;

    cate=1;
    viz[0][0]=1;
    dfs(0,0,cine[0][0]);

    if(cine[0][1]!=cine[0][0])
    {
        viz[0][1]=1;
        cate++;
        dfs(0,1,cine[0][1]);
    }
    else if(cine[1][0]!=cine[0][0])
    {
        viz[1][0]=1;
        cate++;
        dfs(1,0,cine[1][0]);
    }
    else if(cine[1][1]!=cine[0][0])
    {
        viz[1][1]=1;
        cate++;
        dfs(1,1,cine[1][1]);
    }

    return (cate==(n*m));
}

int ii,jj;

int ps,pd;
void backtr(int x,int y)
{
   // cout<<"backtr("<<x<<","<<y<<");"<<endl;
    if(x==n && y==0)
    {
       // cout<<"am oprit "<<endl;

       // for(ii=0;ii<n;ii++)
       // {
           // for(jj=0;jj<m;jj++)
           // {
           //     cout<<cine[ii][jj];
          //  }
         //   cout<<endl;
        //}

       // cout<<"asa"<<endl;
       // cout<<"are ps="<<ps<<" si pd="<<pd<<endl<<endl;
        if(abs(ps-pd)<=k)
        {
            if(verif())
            {
                sol++;
            }
        }
        return;
    }

    int cc=0,i,j;
    for(i=x-1;i<=x && i>=0;i++)
        for(j=y-1;j<=y && j>=0;j++)
            if(i!=x || j!=y)
            {
            if(cine[i][j]==0)
                cc--;
            else
                cc++;
        }
    //if(cc==3)
    //    cout<<"alarma aici "<<endl;

    if(mat[x][y]=='T' || mat[x][y]=='U')
        if(cc>-3)
        {
            ps++;
            cine[x][y]=0;

            if(y<(m-1))
                backtr(x,y+1);
            else
                backtr(x+1,0);
            ps--;
        }

    if(mat[x][y]=='D' || mat[x][y]=='U')
        if(cc<3)
        {
            pd++;
            cine[x][y]=1;

            if(y<(m-1))
                backtr(x,y+1);
            else
                backtr(x+1,0);
            cine[x][y]=0;
            pd--;
        }
}

int main()
{
    int i,j;
    cin>>n>>m>>k;

    if(n==0 || m==0)
    {
        cout<<"1\n"; //de incercat si cu 0 daca iau incorect
        return 0;
    }

    for(i=0;i<n;i++)
        for(j=0;j<m;j++)
            cin>>mat[i][j];
    backtr(0,0);

    cout<<sol<<'\n';
    return 0;
}
