#include<iostream>


using namespace std;

int main()
{
	int n,q,m;

	cin>>n>>m>>q;

	//vector<int> a(n);
	//vector<int> left(n);
	//vector<int> right(n);

	int *a = new int[n];
	int *left = new int[n];
	int *right = new int[n];
	int l(1), r(1);
	for(int i=0; i<n;i++)
	{
		int x;
		cin>>x;
		*(a+i) = x;
	}

	for(int i=0; i<n;i++)
	{
		l= ( (l%m) * (a[i]%m) ) % m;
		r = ( (r%m) * (a[n-1-i]%m) ) % m ;
		left[i] = l;
		right[n-1-i] = r;
	}

	for(int i=0; i<q; i++)
	{
		int index;
		cin>>index;
		
		if(index== 1)
		{
			index = right[1];
		}
		// Product excluding the last element will be stored at left[n-2]
		else if(index == n)
		{
			index = left[n-2];
		}
		else
		{
			// multiply product before the current number ie on the left side and after the no ie on the right side
			index = ((right[index]%m)* (left[index-2]%m) )%m;
		}
		cout<<index<<endl;
	}
	return 0;
}