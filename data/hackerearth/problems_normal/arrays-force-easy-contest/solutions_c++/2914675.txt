#include <iostream>
using namespace std;

long long int freq[1000005];
int main()
{
    int t, A0, A1, N, mod;
    cin>>t;
    while(t--) {
    	cin>>A0>>A1>>N>>mod;
    	int val[N];
   		val[0] = A0;
   		val[1] = A1;
   		for(int i=0; i<=mod; i++) {
   			freq[i] = 0;
   		}
   		freq[A0]++;
   		freq[A1]++;
    	for(int i=2; i<N; i++) {
    		val[i] = (val[i-2] + val[i-1])%mod;
    		freq[val[i]]++;
    	}
    	long long int sum = 0;
    	for(int i=0; i<=mod; i++) {
    		sum += (freq[i]*freq[i]);
    	}
    	cout<<sum<<endl;
    }
    return 0;
}
