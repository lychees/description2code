#include <bits/stdc++.h>
using namespace std;
int v[2*100001], l[2*100001], r[2*100001];
int main()
{
     int t, n, k;
     cin>>t;
     while(t--){
     	cin>>n>>k;
     	
     	for(int i=0; i<n; i++){
     		cin>>v[i];
     	}
     	fill(l, l+n, -1);
     	for(int i=1; i<n; i++){
     		if(v[i]>v[i-1]){
     			l[i]=i-1;
     		}else{
 				int j=i-1;
     			while(j!=-1 && v[j]>v[i]){
     				j = l[j];
     			}
     			l[i]=j;
     		}
     	}
     	fill(r, r+n, -1);
     	for(int i=n-2; i>=0; i--){
     		if(v[i]>v[i+1]){
     			r[i]=i+1;
     		}else{
     			int j=i+1;
     			while(j!=-1 && v[j]>v[i]){
     				j=r[j];
     			}
     			r[i]=j;
     		}
     	}
     	
     	int sum=0;
     	int min_[n];
     	fill(min_, min_+n, INT_MAX);
     	for(int i=0; i<n; i++){
     		if(i-k>=0){
     			if(v[i]>v[i-k]){
     				min_[i] = min(min_[i], k);
     			}else{
     				int j=i-k;
     				while(j!=-1 && v[i]<v[j]){
     					j = l[j];
     				}
     				if(j!=-1){
     					min_[i]=min(min_[i], abs(i-j));
     				}
     			}
     		}
     		if(i+k<n){
     			if(v[i]>v[i+k]){
     				min_[i] = min(min_[i], k);
     			}else{
     				int j=i+k;
     				while(j!=-1 && v[i]<v[j]){
     					j = r[j];
     				}
     				if(j != -1){
     					min_[i]=min(min_[i], abs(i-j));
     				}
     			}
     		}
     	}
     	for(int i=0; i<n; i++){
     		if(min_[i]!=INT_MAX){
     			sum += min_[i];
     		}
     	}
     	cout<<sum<<endl;
     }
    return 0;
}
