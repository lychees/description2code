#include<bits/stdc++.h>
#define ll long long int
#define ite iterator
#define mp make_pair
#define ff first
#define ss second
#define pb push_back
#define ioS ios::sync_with_stdio(false);
using namespace std ;

ll n,i,j,k,d,x,y,ans,t,m,z ;
ll a[5000008],b[5000008],c[5000008] ;


int main(){
cin >> t ;
while(t--){
  cin >>  n >> m >> z ;

  for(i=0;i<n;i++){cin >> a[i] ;}
  j = 1 ; k = 0 ;
  for(i=n-1;i>=0;i--){ k += j*a[i] ; j*=-1 ; }
a[n] = k%m  ;
if(a[n]<0){a[n] += m ;}
j=1;

for(i=0;i<=n;i++){
        if(n%2==0){   b[i] = -1*a[i] + m   ; }
        else{b[i] = a[i] ;}
}

k = z%(n+1) ;
if(z!=n){
    if((z/(n+1)-1)%2==0||(n%2)!=0){
        ans = b[k]%m ;
    }
    else{
        ans = (-1)*b[k] + m ;
    }
}
else{
    ans = a[n] ;
}
cout << ans << endl ;

}

}

