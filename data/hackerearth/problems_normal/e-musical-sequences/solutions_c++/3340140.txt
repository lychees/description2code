#include <iostream>
#include <algorithm>
using namespace std;
#define maxn 2000010
 
long long int a[maxn];
 
int main() {
	// your code goes here
	int t;
	cin>>t;
	while (t--){
		long long int m, z;
	    int n;
		cin>>n>>m>>z;
		z=z-(long long)n;
		for (int i=0; i<=2*n+3; i++) a[i]=0LL;
		for (int i=0; i<n; i++) cin>>a[i];
		for (int i=n-1; i>=0; i--){
			if ((n-i)%2) a[n]+=a[i];
			else a[n]-=a[i];
			a[n]%=m;
		}
		for (int k=1; k<=n; k++){
			if (n%2) a[n+k]= a[k-1];
			else a[n+k]= 0LL-a[k-1];
		}
		if(n%2)
		{
			long long int q= (long long int) (n+1);
	    	long long int pp= z%q;
			cout<<(a[pp+n]+m)%m<<endl;
			continue;
		}
		for(int k=1; k<=n+1; ++k)
			a[n+n+k]=-a[n+k-1];
		long long int q= (long long int) (2*n+2);
	    long long int pp= z%q;
		cout<<(a[pp+n]+m)%m<<endl;
	}
	return 0;
}