#include <iostream>
#include <vector>
#include <map>
using namespace std;
long long MAT[1010][1010], D, N, K, A;
long long MOD = 1e9 + 7;
typedef pair<int,int> PII;
typedef pair<PII, long long> PIIL;
vector<PII> changed;
map<PII, bool> isEdited;
int main()
{
    for (cin >> D; D; D--) {
    	cin >> N >> K >> A;
    	changed.clear();
    	isEdited.clear();
    	for (int i = 0 ; i < N; i++) for (int j = 0; j < N; j++) MAT[i][j] = K;
    	for (int i = 0; i < A; i++) {
    		char a[2];
    		scanf("%s", a);
    		if (a[0] == 'm') {
    			int x1, x2, y1, y2;
    			scanf("%d%d%d%d", &x1, &y1, &x2, &y2);
    			long long ans = (x2 - x1 + 1)*(y2 - y1 + 1)*K;
    			ans %=MOD;
    			for (int j = 0; j < changed.size(); j++) {
    				int dx = changed[j].first;
    				int dy = changed[j].second;
    				long long val = MAT[dx-1][dy-1];
    				if (dx < x1 || dx > x2 || dy < y1 || dy > y2)
    					continue;
    				ans -= K;
    				ans += val;
    				ans = ans > MOD ? ans - MOD : ans;
    			}
    			printf("%d\n", ans);
    			
    		}
    		else {
    			int x1, y1;
    			long long Z;
    			scanf("%d%d%d%ll", &x1, &y1, &Z);
    			MAT[x1-1][y1-1] *= Z;
    			MAT[x1-1][y1-1] %= MOD;
    			PII a = make_pair(x1, y1);
    			bool found = isEdited[a];
    			if (!found) { 
    				changed.push_back(a);
    				isEdited[a] = true;
    			}
    		}
    		
    	}
    }
}
