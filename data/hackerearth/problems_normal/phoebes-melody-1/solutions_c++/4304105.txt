#include<bits/stdc++.h>
#define inf 1000000000
using namespace std ;
int main () {
    int t ;
    scanf ( "%d" , &t ) ;
    while ( t-- ) {
        int ans = 0 ;
        int n , a[200002] , lef[200002] , rig[200002] , k ;
        scanf ( "%d %d" , &n , &k ) ;
        for ( int i = 1 ; i <= n ; i++ ) {
            scanf( "%d" , &a[i] ) ;
            lef[i] = i-1 ;
            rig[i] = i+1 ;
        }
        lef[0] = 0 ;
        rig[n+1] = n+1 ;
        a[0] = 0 ;
        a[n+1] = 0 ;
        for ( int i = 1 ; i <= n ; i++ ) {
            while ( a[i] <= a[lef[i]] && lef[i] > 0 ) {
                lef[i] = lef[lef[i]] ;
            }
        }
        for ( int i = n ; i >= 1 ; i-- ) {
            while ( a[i] <= a[rig[i]] && rig[i] <= n ) {
                rig[i] = rig[rig[i]] ;
            }
        }
        /*for ( int i = 1 ; i <= n ; i++ ) {
            cout << lef[i] << " " << rig[i] << endl ;
        }*/
        int val = inf ;
        for ( int i = 1 ; i <= n ; i++ ) {
            int first_left = i-k , first_right = i+k ;
            while ( first_left > 0 && a[i] <= a[first_left] )
                first_left = lef[first_left] ;
            while ( first_right <= n && a[i] <= a[first_right] )
                first_right = rig[first_right] ;
            val = inf ;
            if ( first_left > 0 && first_left <= i-k )
                val = min ( val , abs ( i-first_left) ) ;
            if ( first_right <= n && first_right >= i+k )
                val = min ( val , abs ( i-first_right ) ) ;
            if ( val != inf )
                ans += val ;
        }
        cout << ans << endl ;
    }
    return 0 ;
}
