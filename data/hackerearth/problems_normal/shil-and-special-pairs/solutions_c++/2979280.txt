#include <bits/stdc++.h>

using namespace std;
typedef long long ll;
#define MAXN 100110
ll M,cnt=0,ft[MAXN],A,x,y;
int arr[MAXN],D,N;

void update(int index){
    for (int i=index;i<MAXN;i+=(i & -i))
        ft[i]++;
}

ll sum(int index){
    ll ans = 0;
    for (int i=index;i;i-=(i & -i))
        ans+=ft[i];
    return ans;
}

bool cmp(pair<pair<int,int>,int> l,pair<pair<int,int>,int> r){
    return l.first.second<r.first.second;
}

int main()
{
    memset(ft,0,sizeof ft);
    int pos[MAXN];
    for (int i=0;i<MAXN;i++)pos[i]=2e9;
    cin >> N >> M >> D;
    for (int i=1;i<=N;i++){
        scanf("%d",&arr[i]);
        pos[arr[i]]=i;
    }
    pair<pair<int,int>,int> q[M];
    for (int i=0;i<M;i++){
        cin >> x >> y;
        q[i].first.first=x;
        q[i].first.second=y;
        q[i].second=i;
    }
    sort(q,q+M,cmp);
    int j = 0;
    ll ans[M];
    for (int i=1;i<=N;i++){
        for (int k=max(1,arr[i]-D);k<=min(N,arr[i]+D);k++){
            if (pos[k]<=i)
                update(pos[k]);
        }
        while (j<M && q[j].first.second==i){
            ll cnt = sum(i) - sum(q[j].first.first-1);
            ans[q[j].second]=cnt;
            j++;
        }
    }
    for (int i=0;i<M;i++)printf("%lld\n",ans[i]);
}
