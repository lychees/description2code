#include<iostream>
#include<vector>
#include<algorithm>
#include<stack>

#define MAX 1000000007

using namespace std;

void reverse(vector<long long> &bulArr, int N)
{
	for(int i = 0, j = N - 1; i < j; ++i, --j)
	{
		int tmp = bulArr[i];
		bulArr[i] = bulArr[j];
		bulArr[j] = tmp;
	}
}

int main()
{
	long long t, N, sum = 0, tmpSum = 0, firstBul, SecBul;
	cin>>t;
	while(t--)
	{
		int sum = 0;
		cin>>N;
		vector<long long> bulArr(N);
		for(int i = 0; i < N; ++i)
		{
			cin>>bulArr[i];
		}
		int index = 0, j;
		while(index < N)
		{
			firstBul = index;
			j = index + 1;
			while(bulArr[j] < bulArr[index])
			{
				++j;
				if(j >= N - 1)
					break;
			}
			if(j >= N - 1)
				break;
			SecBul = j;
			for(int k = firstBul + 1; k < SecBul; ++k)
			{
				sum += bulArr[firstBul] - bulArr[k];
				sum %= MAX;
			}
			index = j;
			++j;
			if(j >= N - 1)
				break;
		}
		reverse(bulArr, N);

		index = 0;
		while(index < N)
		{
			firstBul = index;
			j = index + 1;
			while(bulArr[j] < bulArr[index])
			{
				++j;
				if(j >= N - 1)
					break;
			}
			if(j >= N - 1)
				break;
			SecBul = j;
			for(int k = firstBul + 1; k < SecBul; ++k)
			{
				sum += bulArr[firstBul] - bulArr[k];
				sum %= MAX;
			}
			index = j;
			++j;
			if(j >= N - 1)
				break;
		}

		cout<<sum<<endl;
		bulArr.clear();
	}
	return 0;
 }