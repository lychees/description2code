#include <iostream>
using namespace std;
typedef long long int lli;
int main()
{
    int n,q,m;
    int id;
    int i;
    lli p=1,s=1;
    int a[100005];
    int pmf[100005];
    int pmb[100005];
   	cin>>n>>m>>q;
   	for(i=0;i<n;i++)
   	{
   		cin>>a[i];
   	}
   	for(i=0;i<n;i++)
   	{
   		p=a[i]%m;
   		s=(s*p)%m;
   		pmf[i]=s;
   	}
   	s=1;
   	for(i=n-1;i>=0;i--)
   	{
   		p=a[i]%m;
   		s=(s*p)%m;
   		pmb[i]=s;
   	}
   	while(q--)
   	{
   		cin>>id;
   		if(id==1)
   		{
   			cout<<pmb[id]<<endl;
   		}
   		else if(id==n)
   		{
   			cout<<pmf[n-2]<<endl;
   		}
   		else
   		{
   			cout<<(pmf[id-2]*pmb[id])%m<<endl;
   		}
   	}
    return 0;
}
