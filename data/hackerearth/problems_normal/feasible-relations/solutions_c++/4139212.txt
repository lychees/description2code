#include<bits/stdc++.h>
using namespace std;
#define s 1000001
int a[s],b[s];
string c[s];
int arr[s],sz[s];

int root(int x)
{
	while(arr[x]!=x)x=arr[arr[x]];
	return x;
}
void Union(int x,int y)
{
	int rtx=root(x);
	int rty=root(y);
	if(sz[rtx]>sz[rty])
	{
		arr[rty]=rtx;
		sz[rtx]+=sz[rty];
	}
	else 
	{
		arr[rtx]=rty;
		sz[rty]+=sz[rtx];
	}
}

int main()
{
	int t;
	cin>>t;
	while(t--)
	{
		int n,k;
		cin>>n>>k;
		for(int i=1;i<=n;i++){arr[i]=i;sz[i]=1;}
		for(int i=0;i<k;i++)
		{
			cin>>a[i]>>c[i]>>b[i];
			if(c[i]=="=")Union(a[i],b[i]);
		}
		bool flag=true;
		for(int i=0;i<k;i++)
		{
			if(c[i]=="!=")
			{
				if(root(a[i])==root(b[i])){flag=0;break;}
			}
		}
		if(flag)cout<<"YES"<<endl;
		else cout<<"NO"<<endl;
	}
	return 0;
}