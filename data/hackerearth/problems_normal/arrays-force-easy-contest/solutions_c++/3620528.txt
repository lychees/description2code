#include<iostream>
#include<vector>
#include<algorithm>
#include<cstring>
using namespace std;
void sol()
{
    long int arr[1000001],i,n;
    long int mod,a0,a1,temp;
    long long int sum=0;
    cin>>a0>>a1>>n>>mod;
    memset(arr,0,sizeof(arr));
    arr[a0]++;arr[a1]++;
    for(i=2;i<n;i++)
    {
       temp=(a0+a1)%mod;
       arr[temp]++;
       a0=a1;
       a1=temp;
    }
    for(i=0;i<=1000000;i++)
        if(arr[i]>0) sum+=arr[i]*arr[i];
    cout<<sum<<endl;
}
int main()
{
    int t;
    cin>>t;
    while(t--) sol();
    return 0;
}
