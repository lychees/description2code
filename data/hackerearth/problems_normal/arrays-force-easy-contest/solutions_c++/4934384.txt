#include <iostream>

using namespace std;

int main()
{
	int i, tc;
	long int a, b, n, mod, j;
	long long int temp, sum;
	long int count[1000000];
	cin >> tc;
	for(i = 0; i < tc;i++)
	{
		sum = 0;
		cin >> a >> b >> n >> mod;
		for(j = 0; j < mod; j++)
			count[j] = 0;
		count[a] += 1;
		count[b] += 1;
		for(j = 0; j < n-2; j++)
		{
			temp = a + b;
			temp = temp % mod;
			count[temp] += 1;
			a = b;
			b = temp;
		}
		for(j = 0; j < mod; j++)
		{
			sum += count[j] * count[j];
			count[j] = 0;
		}
		cout << sum << endl;
	}
	return 0;
}