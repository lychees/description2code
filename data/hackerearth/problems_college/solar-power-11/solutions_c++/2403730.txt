#include <iostream>
using namespace std;
	unsigned long long int a[1001][1001],b[1001][1001];

int main()
{

	int n,d,k;
	cin>> d;
	while(d--){
		cin>>n>>k;
		for(int i=0;i<n+1;i++){
			for(int j=0;j<n+1;j++){
				a[i][j] = (k * (i * j) ) % 1000000007;	
				b[i][j] = k;
			}
		}
		int p;
		cin>>p;
	/*	for( int i=1;i<=n;i++){
			for(int j=1;j<=n;j++){
				cout<<a[i][j]<< " ";
			}
			cout<<endl;
		}
	*/
	char ch;
		int z,m;
		unsigned long long int diff;
		int x1,y1,x2,y2;
		while(p--){
			cin>>ch;
			if(ch=='s'){
				cin>>x1>>y1>>z;
			
				diff=( (z - 1) * b[x1][y1] ) % 1000000007;
				b[x1][y1] = (b[x1][y1] * z) % 1000000007;
				for(int i = x1 ; i <= n ; i++){
					for(int j = y1 ; j <= n ; j++){
						a[i][j] = (a[i][j]+diff) % 1000000007;
					}
				}
			}
			else{
				cin>>x1>>y1>>x2>>y2;
				cout<<(a[x2][y2] + a[x1-1][y1-1] - a[x1-1][y2] - a[x2][y1-1])%1000000007 << endl;
			}
		}
	}
    return 0;
}
