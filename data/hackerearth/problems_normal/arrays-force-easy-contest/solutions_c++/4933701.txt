#include <iostream>
#include<math.h>
using namespace std;

int main()
{
    int t;
    cin>>t;
   long int y[t];
    int k=0;
    while(t-->0)
    {
      long int a,b,n,mod;
       cin>>a>>b>>n>>mod;
      long int arr[n];
       arr[0]=a;
       arr[1]=b;
       for(int i=2;i<n;i++)
       {
       	arr[i]=(arr[i-1]+arr[i-2])%mod;
       }
       int w[1000000]={0};
       for(int i=0;i<n;i++)
       {
       	w[arr[i]]++;
       }
      long int sum=0;
       for(int i=0;i<mod;i++)
       {
       	if(w[i]>0)
       	sum=sum+pow(w[i],2);
       }
       y[k]=sum;
       k++;
    }
    for(int i=0;i<k;i++)
    cout<<y[i]<<"\n";
    return 0;
}
