#include<bits/stdc++.h>
using namespace std;
vector <int> v1[1000005];
vector <int> v2[1000005];
int vis[1000005];
int t,n,k;
int main()
{
	cin>>t;
	while(t--)
	{
		memset(vis,-1,sizeof(vis));
		for(int i=0;i<=n;i++)
		v1[i].clear(),v2[i].clear();
		cin>>n>>k;
		while(k--)
		{
			int x1,x2;
			string s;
			cin>>x1>>s>>x2;
			if(s[0]=='=')
			v1[x1].push_back(x2),v1[x2].push_back(x1);
			else
			v2[x1].push_back(x2),v2[x2].push_back(x1);
		}
		int flag=0;
		for(int i=1;i<=n;i++)
		{
			if(vis[i]==-1)
			{
				vis[i]=i;
				stack <int> s;
				s.push(i);
				while(!s.empty())
				{
					int temp=s.top();
					s.pop();
					for(int j=0;j<v1[temp].size();j++)
					{
						if(vis[v1[temp][j]]==-1)
						vis[v1[temp][j]]=vis[temp],s.push(v1[temp][j]);
					}
				}
			}
		}
		for(int i=1;i<=n;i++)
		{
			for(int j=0;j<v2[i].size();j++)
			{
				if(vis[i]==vis[v2[i][j]])
				flag++;
			}
		}
		if(flag==0)
		cout<<"YES"<<endl;
		else
		cout<<"NO"<<endl;
	}
}
