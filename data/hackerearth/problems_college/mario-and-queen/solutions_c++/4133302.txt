#include<bits/stdc++.h>
using namespace std;
#define ll long long int
int graph[11][11];

set<ll> st;
int n;
ll rec(int x, int y, ll dis)
{
	if(x > n || y > n) return INT_MAX;
	if(x < 1 || y < 1) return INT_MAX;
	if(graph[x][y] == 0) return INT_MAX;
	if(graph[x][y] == 2) 
	{
		//vt.push_back(dis);
		st.insert(dis);
		return dis;
	}
	int d1,d2;
	graph[x][y] = 0;
	d1 = min(min(rec(x-1,y+1,dis+1),rec(x,y+1,dis+1)),min(rec(x+1,y+1,dis+1),rec(x+1,y,dis+1)));
	d2 = min(min(rec(x+1,y-1,dis+1),rec(x,y-1,dis+1)),min(rec(x-1,y-1,dis+1),rec(x-1,y,dis+1)));
	graph[x][y]=1;
	return min(d1,d2);
}
int main()
{
    //cout << "Hello World!" << endl;
    int t;
    cin>>t;
    int b=1;
    while(t--)
    {
    	st.clear();
    	cin>>n;
    	int i;
    	int x,y;
    	//1=empty, 2=destintion, 0=not allowed;
    	for(i=1;i<=n;++i)
    	{
    		for(int j=1;j<=n;++j)
    		{
    			char z;
    			cin>>z;
    			if(z == '.') graph[i][j]=1;
    			else if(z == '$') graph[i][j] = 0;
    			else if(z =='Q') graph[i][j]=2;
    			else
    			{
    				x=i;
    				y=j;
    				graph[i][j]=1;
    			}
    		}
    	}

    	ll opt;
		opt = rec(x,y,0);
		cout<<"Case "<<b<<": ";
		if(opt >= INT_MAX) cout<<-1<<endl;
		else 
		{
		//sort(vt.begin(),vt.end());
			cout<<opt<<" < ";
			set<ll>::iterator it;
			for(it=st.begin();it!=st.end();++it)
				cout<<*it<<" ";
			cout<<">"<<endl;
		}
		b++;
    }
    return 0;
}
