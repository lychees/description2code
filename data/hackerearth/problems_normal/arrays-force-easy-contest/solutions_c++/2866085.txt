#include <iostream>
#include <bits/stdc++.h>
using namespace std;
long long int a[1000001]={0};
int main()
{
	int i,n,t;
	scanf("%d",&t);
	while(t--)
	{
		int x,y,m;
		memset(a,0,sizeof a);
	scanf("%d %d %d %d",&x,&y,&n,&m);n-=2;
	a[x]++;a[y]++;int temp;
		while(n--)
		{
			temp=y;
			
			y=(x+y)%m;
			x=temp;
			a[y]++;
		}
		long long int sum=0;
		for(i=0;i<=1000000;i++)
		sum+=a[i]*a[i];
		printf("%llu\n",sum);
	}
    return 0;
}
