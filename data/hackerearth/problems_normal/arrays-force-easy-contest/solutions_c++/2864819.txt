#include <iostream>
using namespace std;

#define ll long long
int main()
{
    ll t,n,a,b,count[1000004]={0},mod,i,j,temp,res,val;
    cin>>t;
    while(t--)
    {
    	res=0;
    	for(i=0;i<1000004;i++)
    	 count[i]=0;
    	cin>>a>>b>>n>>mod;
    	count[a]++;count[b]++;
    	for(i=2;i<n;i++)
    	 {
    	 	val=(a+b)%mod;
    	 	count[val]++;
    	 	temp=b;
    	 	b=val;
    	 	a=temp;
    	 	
    	 }
    	 
    	 for(i=0;i<1000005;i++)
    	   if(count[i])
    	     res+=count[i]*count[i];
    	
    cout<<res<<endl;	
    	
    }
    
    return 0;
}
