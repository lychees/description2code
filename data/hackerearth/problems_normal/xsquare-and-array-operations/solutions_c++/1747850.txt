#include <bits/stdc++.h>
using namespace std;
#define PII pair <int, int> 
int arr[500005]; 
int lastgreater [500005];
int nextgreater [500005]; 
int main()
{
	int T;scanf("%d", &T); 
	for (int g=0; g<T; g++)
	{memset(lastgreater,0,sizeof(lastgreater)); memset(nextgreater,0,sizeof(nextgreater));
		int N; scanf("%d", &N); 
		for (int y=1; y<=N; y++) scanf("%d", &arr[y]);
		int maxi=-1, indice=-1; 
		for (int y=1; y<=N; y++)
		{
			if (arr[y]>maxi)
			{
				maxi=arr[y]; indice=y; 
			}
		}
		stack <int> r; 
		for (int y=1; y<=N; y++)
		{
			while (r.size() && r.top()<arr[y])
			{
				r.pop(); 
			}
			if (r.size())
			{
				lastgreater[y]=r.top();
			}
			r.push(arr[y]); 
		}while(r.size())r.pop(); 
		for (int y=N; y>=1; y--)
		{
			while (r.size() && r.top()<arr[y])
			{
				r.pop();
			}
			if (r.size()) nextgreater[y]=r.top(); 
			r.push(arr[y]);
		} 
		long long answer=0; 
		for (int g=1; g<=N; g++)
		{if (g==indice) continue;
			if (lastgreater[g]==0 && nextgreater[g]==0) continue;
			if (lastgreater[g]==0)
			{
				answer+=nextgreater[g]; continue; 
			}
			if (nextgreater[g]==0)
			{
				answer+=lastgreater[g]; continue;
			}
			
			answer+=min(lastgreater[g], nextgreater[g]); 
		}
		printf("%lld\n", answer); 
	}
}