#include <iostream>
#include <vector>
#include <stdlib.h>
#include <numeric>
#define MOD 1000000007
using namespace std;
int main(){
    int T;
    cin>>T;
    vector<long long int> answers;
    long long int water=0;
    for(int i=0; i<T; i++){
        int n;
        cin>>n;
        vector<int> a;
        water = 0;
        for(int j=0; j<n; j++){
            int tmp;
            cin>>tmp;
            a.push_back(tmp);
        }
        vector<int> convex;
        vector<int> index;
        convex.push_back(a[0]);
        index.push_back(0);
        convex.push_back(a[1]);
        index.push_back(1);
        for(int j=2; j<a.size(); j++){
            while(convex.size() > 1){
                int top = convex[convex.size()-1];
                int next_top = convex[convex.size()-2];
                if(a[j] >= top && top <= next_top){
                    convex.pop_back();
                    index.pop_back();
                }
                else{
                    break;
                }
            }
            convex.push_back(a[j]);
            index.push_back(j);
            
        }
        //cout<<"Index Size: "<<index.size()<<endl;
        for(int j=1; j<index.size(); j++){
          //  cout<<"Index: "<<a[index[j]]<<" "<<a[index[j-1]]<<endl;
            int minimum = min(a[index[j]], a[index[j-1]]);
            //cout<<"Minimum: "<<minimum<<endl;
            for(int k=index[j]-1; k>index[j-1]; k--){
                int water1 = abs(a[k] - minimum);
                water = (water + water1%MOD)%MOD; 
            } 
        }
        answers.push_back(water);
    }
    for(int i=0; i<answers.size(); i++)cout<<answers[i]<<endl;
    return 0;
}

