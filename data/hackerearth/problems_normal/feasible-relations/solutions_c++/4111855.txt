/********************************/
/*                              */
/*    Author:-Shakti Raj        */
/*            Pandey            */
/*                              */
/*                              */
/********************************/

#include<bits/stdc++.h>
#include<stdlib.h>
using namespace std;
typedef long long lld;
typedef long long unsigned llu;
lld mod=1e9+7;

#define    vl     vector<lld > 
#define    vi     vector<int >
#define    vv     vector<vl  >
#define    pl     pair<lld,lld >
#define    pp     pair<int,int >
#define  sc(a)    scanf("%lld",&a)
#define sc2(a,b)  scanf("%lld%lld",&a,&b)
#define  pr(a)    printf("%lld\n",a);
#define  all(x)   x.begin(),x.end()
   
lld parent[1000002];
template<class T>
T find_root(T a)  //---for root of a
{
	while(parent[a]!=a)
     {
     	
     	parent[a]=parent[parent[a]];
     	a=parent[a];
     }
	 
	return a; 	

}
void unio(lld a,lld b)
{
   lld p_a=find_root(a);
   lld p_b=find_root(b);

    parent[p_b]=p_a;
   
}

int main()
{
  lld t;
  cin>>t;

  while(t--)
  { 
  	 lld n,k,i;
  	  cin>>n>>k;
     lld a[1000002],b[1000002];
     string str[1000002];
  	 for(i=1;i<=n;i++)
  	  parent[i]=i;

  	 for(i=1;i<=k;i++)
  	 { 
        cin>>a[i]>>str[i]>>b[i];
          if(str[i]=="=")
          	unio(a[i],b[i]);
  	 }  
  	 //for(i=1;i<=n;i++)
  	 // cout<<parent[i]<<" ";

  	 
    lld flag=0;
  	 for(i=1;i<=k;i++)
  	 {    if(str[i]!="=")
          { if(find_root(a[i])==find_root(b[i]))
              flag=1;

           }             
  	 }	

     if(flag)
     	cout<<"NO\n";
     else
     	cout<<"YES\n";



  }




}
