//Sinha Saab
//NARUTO Fan



#include <cstdio>
#include <iostream>
#include <algorithm>
#include <string.h>
#include <vector>
#include <set>
#include <map>
#include <queue>
#include <list>
#include <math.h>

#define ll long long int
#define maxN 100
#define maxVal (ll)1000000000000
#define minVal -100000000
#define mod 1000000007LL

#define gcd(a,b) __gcd(a,b)

using namespace std;

ll n,m,k;
ll d[maxN+5][maxN+5];
vector<pair<ll,pair<ll,ll> > > edge;
ll parent[maxN+5];

ll get(ll i)
{
	if(i!=parent[i])
		parent[i]=get(parent[i]);
	return parent[i];
}

int main()
{
    ll t,i,j,k,p,u,v,w,ans,x,y;
    scanf("%lld",&t);
    while(t--)
    {
    	edge.clear();
    	scanf("%lld%lld%lld",&n,&m,&p);
    	for(i=1;i<=n;i++)
    		parent[i]=i;
    	for(i=1;i<=n;i++)
    		for(j=1;j<=n;j++)
    			if(i==j)
    				d[i][j]=0;
    			else
    				d[i][j]=maxVal;
    	while(m--)
    	{
    		scanf("%lld%lld%lld",&u,&v,&w);
    		d[u][v]=min(d[u][v],w);
    		d[v][u]=min(d[v][u],w);
    	}
    	for(k=1;k<=n;k++)
    		for(i=1;i<=n;i++)
    			for(j=1;j<=n;j++)
    				d[i][j]=min(d[i][j],d[i][k]+d[k][j]);
    	for(i=1;i<=p;i++)
    		for(j=(i+1);j<=p;j++)
    			edge.push_back(make_pair(d[i][j],make_pair(i,j)));
    	sort(edge.begin(),edge.end());
    	ans=0;
    	for(i=0;i<(ll)edge.size();i++)
    	{
    		w=edge[i].first;
    		u=edge[i].second.first;
    		v=edge[i].second.second;
    		//printf("%lld %lld %lld\n",u,v,w);
    		x=get(u);
    		y=get(v);
    		if(x!=y)
    		{
    			ans=ans+w;
    			parent[x]=y;
    		}
    	}
    	printf("%lld\n",ans);
    }
    return 0;
}