#include <bits/stdc++.h>
#define MOD 1000000007
#define X first
#define Y second
using namespace std;
typedef long long ll;
int main()
{
	int tt;
	std::vector<pair<pair<int,int>,pair<int,int> > > v;
	scanf("%d",&tt);
	while(tt--)
	{
		v.clear();
		int n;
		scanf("%d",&n);
		for(int i=0;i<n;i++)
		{
			int x, y ;
			char dir[2];
			scanf("%d%d%s",&x,&y,dir);
			x*=2;
			y*=2;
			pair<int , int > speed;
			if(dir[0]=='N')speed=make_pair(0,1);
			else if(dir[0]=='S')speed=make_pair(0,-1);
			else if(dir[0]=='W')speed=make_pair(-1,0);
			else speed=make_pair(1,0);
			v.push_back(make_pair(make_pair(x,y),speed));
		}
		for(int t=0;t<4401;t++)
		{
			for(int i=0;i<(int)v.size();i++)
			{
				v[i].X.X=v[i].X.X+v[i].Y.X;
				v[i].X.Y=v[i].X.Y+v[i].Y.Y;
			}
			sort(v.begin(),v.end());
			bool del[100];
			memset(del,0,sizeof del);
			for(int i=0;i<(int)v.size()-1;i++)
			{
				if(v[i].X==v[i+1].X)del[i]=del[i+1]=1;
			}
			int deli=0,l=(int)v.size();
			for(int i=0;i<l;i++)
			{
				if(del[i])
				{
					v.erase(v.begin()+(i-deli));
					deli++;
				}
			}
		}
		printf("%d\n",(int)v.size() );
	}
	return 0;
}