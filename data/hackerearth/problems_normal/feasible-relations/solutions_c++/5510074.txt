#include<bits/stdc++.h>
using namespace std;
#define LL long long
#define S 1000005
#define W while
#define M 1000000007
#define str string
#define pi 3.14159265
LL mini=INT_MAX;
LL maxi=INT_MIN;
vector<int> v[1000003];
vector<pair<int,int> > b;
int visited[1000003];
int cnt;
int dfs(int i)
{
	visited[i]=cnt;
	for(int j=0;j<v[i].size();j++)
	{
		int k=v[i][j];
		if(!visited[k])
		{
			dfs(k);
		}
		
	}
	
}

int main()
{
	int t;
	cin>>t;
	W(t--)
	{
		int n,k;
		cin>>n>>k;
		int flag=0;
		b.clear();
		for(int i=0;i<=n;i++)
			visited[i]=0,v[i].clear();
		W(k--)
		{
				
				int x,y;
				str r;
				cin>>x>>r>>y;
			//	cout<<x<<r<<y<<endl;
				if(r[0]=='=')
				{
					v[x].push_back(y);
					v[y].push_back(x);
				}
				else
				{
					b.push_back(make_pair(x,y));
				}
		}
		for(int i=1;i<=n;i++)
		{
			cnt++;
			if(!visited[i])
				dfs(i);
		}
		for(int i=0;i<b.size();i++)
		{
			if(visited[b[i].first]&&visited[b[i].first]==visited[b[i].second])
			{
				flag=1;
				break;
			}
		}
		if(!flag)
			cout<<"YES\n";
		else 
			cout<<"NO\n";
	}
	return 0;
}