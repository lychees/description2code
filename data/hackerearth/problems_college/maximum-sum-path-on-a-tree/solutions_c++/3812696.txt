#include<bits/stdc++.h>
#define lim 50006
#define mod 1000000007
#define ll long long
#define Max LONG_LONG_MAX
#define Min LONG_LONG_MIN
#define pb push_back
#define MIN -99999999999
using namespace std;
ll j,t,k,n,c[lim],p,maxi[lim],cnt[lim],val[lim];
vector<ll> adj[lim];
bool visited[lim];
void dfs(ll u)
{
	ll i;
	visited[u]=1;
	//cout<<u<<endl;
	for(i=0;i<adj[u].size();i++)
	{
		if(!visited[adj[u][i]])
		dfs(adj[u][i]);
	}
	
	ll m1=0,m2=0,index;
	
	 for(i=0;i<adj[u].size();i++)
	 {
		
		if(maxi[adj[u][i]]>m1)
		{
		 m1=maxi[adj[u][i]];
		 index=i;
		}
		
	 }
	
	for(i=0;i<adj[u].size();i++)
	{
		
		if(maxi[adj[u][i]]>m2&&index!=i)
		m2=maxi[adj[u][i]];
	}
	
	
	maxi[u]=max(val[u]+m1,val[u]);
	
	cnt[u]=val[u];
	
	
	cnt[u]=max(cnt[u]+m1,cnt[u]);
	
	cnt[u]=max(cnt[u]+m2,cnt[u]);
	
}

int main()
{
  ios_base::sync_with_stdio(false);cin.tie(NULL);
  
  //freopen("input.txt", "r", stdin);
  ll i,t;
  
  cin>>t;
  
  while(t--)
  {
  cin>>n;
  
  for(i=1;i<lim;i++)
  {
  	adj[i].clear();
  	cnt[i]=0;
  	maxi[i]=0;
  	visited[i]=0;
  }
  
  for(i=1;i<=n;i++)
  cin>>val[i];

  ll x,y;

  for(i=2;i<=n;i++)
  {
  	cin>>x>>y;
  	
  	
  	adj[x].pb(y);
  	adj[y].pb(x);
  }
  
  dfs(1);
   
  ll m=Min;

  for(i=1;i<=n;i++)
  m=max(m,cnt[i]);

  cout<<m<<endl;
  
  }
  
  return 0;
}
