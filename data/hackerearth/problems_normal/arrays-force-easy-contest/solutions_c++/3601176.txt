#include <bits/stdc++.h>
#define ll long long int
using namespace std;

ll a[1000002];
int main()
{
    ll t,i,a1,b,mod,count,sum,n;
    cin>>t;
    while(t--){
    	ll hash[1000002]={0};
    	cin>>a1>>b>>n>>mod;
    	a[0]=a1;a[1]=b;
    	hash[a[0]]++;hash[a[1]]++;
    	for(i=2;i<n;i++){
    		a[i]=(a[i-1]+a[i-2])%mod;
    		hash[a[i]]++;
    	}
    	sum=0;
    	for(i=0;i<1000002;i++){
    		sum+=(hash[i]*hash[i]);
    	}
    	/*sort(a,a+n);
    	count=1;sum=0;
    	for(i=0;i<n;i++){
    		if(a[i]==a[i+1]){
    			count++;
    		}
    		else{
    			sum+=(count*count);
    			count=1;
    		}
    	}*/
    	
    	cout<<sum<<endl;
    }
}
