#include <iostream>
#include <string>
#include <stdio.h>
using namespace std;

#define ll long long

ll modpow(ll n,ll x,ll m)
{
	if(n==0 )return 1;
	ll ans = modpow(n/2,x,m);
	ans=(1ll*ans*ans)%m;
	if( (n&1) )
		ans=(1ll*ans*x)%m;
		
		return ans;
}

ll gp_sum(ll n,ll x,ll mod)
{
	if(n==0)return 1;
	
	if(! (n&1))
		return (modpow(n,x,mod)+gp_sum(n-1,x,mod))%mod;
		
		return ((1+1LL*modpow((n+1)/2,x,mod))*gp_sum(n>>1,x,mod))%mod;
}

int main()
{
	int inumftest;
	
	scanf("%d",&inumftest);
	
	while(inumftest--)
	{
		ll n=0,x=0,m=0;
		scanf("%lld %lld %lld",&n,&x,&m);
		
		ll ans=modpow(n,x,m);
		ll ans1=gp_sum(n,x,m)-1;
		
		ans1=(2*ans1)%m;
		ans1%=m;
		
		if(ans1<0)
			ans1+=m;
		
		printf("%lld\n",ans1);
	}
	
    return 0;
}
