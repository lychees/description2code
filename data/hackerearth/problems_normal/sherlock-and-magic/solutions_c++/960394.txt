#include <iostream>
#include <vector>
#include <map>
using namespace std;

int main()
{
    int t;
    cin>>t;
    while(t--){
    	int n;
    	cin>>n;
    	vector<pair<int, int> > coors;
    	vector<char> dir;
    	vector<bool> pass;
    	vector<bool> end;
    	map<pair<int,int> , vector<int> > a;
    	for(int i=0;i<n;i++){
    		int x;
    		int y;
    		char d;
    		cin>>x;
    		cin>>y;
    		cin>>d;
			coors.push_back(make_pair(2*x,2*y));
			dir.push_back(d);
			//a[coors[i]].push_back(i);
    	}
    	for(int i=0;i<n;i++){
    		pass.push_back(true);
    	}
    	
    	for(int i=0;i<n;i++){
    		end.push_back(false);
    	}
    	int count = n;
    	
    	/*map<pair<int,int>  , vector<int> > :: iterator it;
    		for(it=a.begin();it!=a.end();it++){
    			vector<int> tmp = it->second;
    			int s = tmp.size();
    			if(s > 1){
    				for(int k=0;k<s;k++){
    					pass[tmp[k]]=false;
    				}
    				count-=s;
    			}
    		}
    		a.clear();*/
    		
    	
    	
    	for(int i=1;i<=4000;i++){
    		if(count==0){
    			break;
    		}else{
    			for(int j=0;j<n;j++){
    			if(pass[j]){
    				pair<int,int> x = coors[j];
    				if(dir[j]=='N'){
    					//if(x.second < 1000){
    						x.second+=1;
    					//}else{
    						//pass[j]=false;
    						//x.second=-1000;
    					//}
    				}else
    				if(dir[j]=='W'){
    					//if(x.first > -1000){
    						x.first-=1;
    					//}else{
    						//pass[j]=false;
    						//x.first=1000;
    					//}
    				}else
    				if(dir[j]=='E'){
    					//if(x.first < 1000){
    						x.first+=1;
    					//}else{
    					//	pass[j]=false;
    					//x.first=-1000;
    					//}
    				}else
    				if(dir[j]=='S'){
    					//if(x.second > -1000){
    						x.second-=1;
    					//}else{
    					//	pass[j]=false;
    						//x.second=1000;
    				//	}
    				}
    				a[x].push_back(j);
    				coors[j]=x;
    			}
    		}
    		map<pair<int,int>  , vector<int> > :: iterator it;
    		for(it=a.begin();it!=a.end();it++){
    			vector<int> tmp = it->second;
    			int s = tmp.size();
    			if(s > 1){
    				for(int k=0;k<s;k++){
    					pass[tmp[k]]=false;
    				}
    				count-=s;
    			}
    		}
    		a.clear();
    		}
    		
    	}
    	cout<<count<<endl;
    }
    return 0;
}
