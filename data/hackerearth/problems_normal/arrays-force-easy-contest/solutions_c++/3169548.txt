#include<bits/stdc++.h>
using namespace std;

 int main()
{
	long long int test,n,mod,x,y,i,j;
	long long int a[1000010];
	
	cin>>test;
	for(i=0;i<test;i++)
	{
		//long long int a[1000010];

		cin>>x>>y>>n>>mod;
		for(j=0;j<1000010;j++)
		{
			a[j]=0;
		}

		a[x]++;
		a[y]++;

		for(j=0;j<n-2;j++)
		{
			long long int z=(x%mod + y%mod)%mod;

			a[z]++;
			x=y;
			y=z;
		}

		long long int sum=0;
		for(j=0;j<1000010;j++)
		{
			sum+=a[j]*a[j];
		}
		cout<<sum<<endl;
	}

	return 0;
}
			





