#include <bits/stdc++.h>

using namespace std;


int v[200010],li[200010],ri[200010];
vector < int > vl[200010],vr[200010];
int a[200010];
int l,r;
int main()
{
	int t,n,k,lo,hi,mid,idx,i,sum;

	//freopen("input.txt","r",stdin);
	cin>>t;

	while(t--)
	{
		cin>>n>>k;
		sum=l=r=0;
		for(i=1;i<=n;i++)
		{
			cin>>a[i];
		}

		for(i=1;i<=n;i++)
		{
			idx = i-k;

			if(idx>0)
			{
				while(l-1>=0 && a[v[l-1]]>a[idx])
					{l--;}
				v[l++]=idx;
			}

			li[i]=-1e9;
			if(l-1>=0)
			{
				lo=0,hi=l-1;
				while(lo<=hi)
				{
					mid=(hi+lo)/2;
					if(a[v[mid]] < a[i])
					{
						lo=mid+1;
					}
					else
					{
						hi=mid-1;
					}
				}
				if(lo-1 >= 0 )
					li[i]=v[lo-1];
			}


			
		}

		for(i=n;i>=1;i--)
		{
			idx = i+k;

			if(idx<=n)
			{
				while(r-1>=0 && a[v[r-1]]>a[idx])
					{r--;}
				v[r++]=idx;
			}

			ri[i]=1e9;
			if(r-1>=0)
			{
				lo=0,hi=r-1;
				while(lo<=hi)
				{
					mid=(hi+lo)/2;
					if(a[v[mid]] < a[i])
					{
						lo=mid+1;
					}
					else
					{
						hi=mid-1;
					}
				}
				if(lo-1 >= 0 )
					ri[i]=v[lo-1];
			}
			
		}

		for(i=1;i<=n;i++)
		{
			if(li[i]==-1e9 &&  ri[i]==1e9)
				sum+=0;
			else
				sum+=min(i-li[i],ri[i]-i);
		}
		cout<<sum<<endl;

	}
}