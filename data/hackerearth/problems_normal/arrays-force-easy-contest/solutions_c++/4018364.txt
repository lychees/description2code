#include<iostream>
#include<algorithm>
#include<stdio.h>
using namespace std;
int main()
{
	int t;
	cin>>t;
	while(t>0)
	{
		int a0,a1,n,mod;
		scanf("%d",&a0);
		scanf("%d",&a1);
		scanf("%d",&n);
		scanf("%d",&mod);
		vector<long long int> vec;
		vec.assign(mod,0);
		vec[a0]++;
		vec[a1]++;	
		long long int temp;
		for(int i=2;i<n;i++)
		{
			temp=(a1+a0)%mod;
			vec[temp]++;
			a0=a1;
			a1=temp;
		}
		long long int sum=0;
		for(int i=0;i<vec.size();i++)
		{
			sum=sum+(vec[i])*(vec[i]);
		}
		printf("%lld\n",sum);
		t--;
	}
}