#include <bits/stdc++.h>
#define pb push_back
#define mp make_pair
#define ll long long
#define pii pair< ll,ll >
#define f first
#define s second
using namespace std;

ll l[200005];
ll r[200005];
ll arr[200005];
int main()
{
    ll t,n,k;
    cin>>t;
    while(t--)
    {
    	cin>>n>>k;
    	for(ll i=0;i<n;i++)
        {
            cin>>arr[i];
            l[i]=-1;
            r[i]=n;
        }
    	stack< ll > s;
        for(ll i=0;i<n;i++)
        {
          while(!s.empty()&&arr[s.top()]<=arr[i]) s.pop();
          if(!s.empty()) l[i]=s.top();
          s.push(i);
          l[i]++;
        }
        while(!s.empty()) s.pop();

        for(ll i=n-1;i>=0;i--)
        {
            while(!s.empty()&&arr[s.top()]<=arr[i]) s.pop();
            if(!s.empty()) r[i]=s.top();
            s.push(i);
            r[i]--;
        }

        vector< ll > v;
        ll ans[200005];
        map< ll , vector< pair< ll , pii > > > interval;
        for(int i=0;i<n;i++) interval[arr[i]].pb(mp(i,mp(l[i],r[i])));

        v.pb(0); ans[0]=0; ll j=1;

        for(map< ll,vector< pair< ll,pii > > >::iterator it1=interval.begin(),en=interval.end();it1!=en;it1++)
        {
            ll count=0;

            for(int i=0;i<it1->s.size();i++)
            {
                if(i&&it1->s[i-1].s.s>=it1->s[i].s.f) it1->s[i].s.f=it1->s[i-1].f+1;
                count+=(ll)((ll)it1->s[i].s.s - (ll)it1->s[i].f + 1LL) * ((ll)it1->s[i].f - (ll)it1->s[i].s.f + 1LL);
            }

            v.pb(it1->first);
            ans[j]=ans[j-1]+count;
            j++;
        }

        n=v.size()-1;
        ll res;
        ll x=lower_bound(v.begin(),v.end(),k)- v.begin();
        if(v[x]==k) res=ans[n]-ans[x];
        else res=ans[n]-ans[x-1];
        cout<<res<<endl;
    }
    return 0;
}
