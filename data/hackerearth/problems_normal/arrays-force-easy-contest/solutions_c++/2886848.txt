#include <cstdio>
    #include <algorithm>
    #include <vector>
    #include <iostream>
    #include <string>
    #include <string.h>
    #include <cmath>
    #include <set>
    #include <map>
    #include <bitset>
    #include <iomanip>
     
     
    using namespace std;
    const int maxn=1E6+100;
    int A1[maxn],N,MOD;
    long long cnt[maxn];
    int a,b;
    void solve()
    {
    cin>>a;
    //cout<<" ";
    cin>>b;
    // cout<<" ";
    cin>>N;
    // cout<<" ";
    cin>>MOD;
    int *A = new int[N];
    A[0]=a;
    A[1]=b;
    for(int j=0;j<MOD;j++)
    {
    cnt[j]=0;
    }
    for(int j=2;j<N;j++)
    {
    A[j]=A[j-1]+A[j-2];
    A[j]%=MOD;
    }
    for(int j=0;j<N;j++)
    {
    cnt[A[j]]++;
    }
    long long ans=0;
    for(int j=0;j<MOD;j++)
    {
    ans+=cnt[j]*cnt[j];
    }
    cout<<ans<<endl;
     
    }	
     
    int main()
    {
    int T;
     
    cin>>T;
    for(int i=0;i<T;i++)
    {
    solve();
    }
   
    return 0;
    }
