#include <bits/stdc++.h>
using namespace std;

int A[1000000];

const int MOD = 1000000007;

int trap(int n) {
        int *maxLeft = (int *) calloc(sizeof(int),n);
        int *maxRight = (int *) calloc(sizeof(int),n);
        
        maxLeft[0] = A[0];
        
        for(int i = 1; i < n; ++i){
            maxLeft[i] = max(maxLeft[i-1],A[i]);
        }
        
        maxRight[n-1] = A[n-1];
        
        int ans = 0;
        for(int i = n - 2; i >= 0; --i){
            maxRight[i] = max(maxRight[i+1],A[i]);
            
            ans = (ans + max( min(maxRight[i], maxLeft[i]) - A[i], 0)) % MOD;
        }
        
        return ans%MOD;
    }

int main()
{
    int T;
    cin>>T;
    
    while(T-->0){
    	int N;
    	cin>>N;
    	for(int i = 0; i < N; ++i){
    	   cin>>A[i];
    	}
    	cout<<trap(N)<<"\n";
    	
    	
    }
    return 0;
}
